# Тестирование Video to GIF Converter

Проект содержит полный набор тестов для проверки функциональности конвертера видео в GIF.

## Структура тестов

### 1. Юнит-тесты (`converter/tests.py`)

**VideoConverterTests** - тесты для класса VideoConverter:
- Инициализация с MoviePy и FFmpeg
- Проверка доступности FFmpeg
- Получение информации о видео
- Конвертация с MoviePy (успешная и с ошибками)
- Конвертация с FFmpeg (успешная и с ошибками)

**UtilityFunctionsTests** - тесты для вспомогательных функций:
- Сохранение загруженного видео
- Сохранение конвертированного GIF
- Очистка временных файлов

**FormsTests** - тесты для форм:
- Валидация VideoUploadForm
- Валидация VideoProcessingForm
- Проверка настроек конвертации
- Обработка ошибок валидации

**ViewsTests** - тесты для представлений:
- GET запрос к главной странице
- AJAX конвертация (успешная, без файла, с большим файлом)
- Получение информации о видео
- Проверка статуса конвертера

### 2. Интеграционные тесты (`test_integration.py`)

**VideoConverterIntegrationTests** - комплексные тесты:
- Полный процесс конвертации с MoviePy
- Полный процесс конвертации с FFmpeg
- Процесс загрузки и сохранения файлов
- Интеграция валидации форм
- AJAX конвертация (интеграция)
- Получение информации о видео (интеграция)
- Проверка статуса конвертера (интеграция)
- Обработка ошибок (интеграция)

### 3. Тестовые утилиты (`test_utils.py`)

**VideoFileGenerator** - генератор тестовых файлов:
- Создание малых видеофайлов
- Создание больших видеофайлов
- Создание файлов различных форматов

**MockVideoConverter** - мок-класс для конвертера:
- Имитация конвертации
- Имитация получения информации о видео
- Отслеживание вызовов методов

**VideoTestCase** - базовый класс для тестов:
- Автоматическая очистка временных файлов
- Дополнительные утилиты для тестирования
- Проверки состояния файлов

**PerformanceTestUtils** - утилиты для тестов производительности:
- Измерение времени выполнения
- Проверка производительности

## Запуск тестов

### Все тесты
```bash
python manage.py test
```

### Только юнит-тесты
```bash
python manage.py test converter.tests
```

### Только интеграционные тесты
```bash
python manage.py test test_integration
```

### Тесты производительности
```bash
python test_utils.py
```

### С подробным выводом
```bash
python manage.py test converter.tests -v 2
```

### С сохранением тестовой базы данных
```bash
python manage.py test --keepdb
```

## Покрытие тестами

Тесты покрывают следующие аспекты:

✅ **Конвертация видео**
- MoviePy конвертация
- FFmpeg конвертация
- Обработка ошибок конвертации
- Параметры конвертации (размер, fps, временные рамки)

✅ **Работа с файлами**
- Загрузка видеофайлов
- Сохранение GIF файлов
- Очистка временных файлов
- Проверка размеров файлов

✅ **Валидация форм**
- Проверка типов файлов
- Проверка размеров файлов
- Проверка параметров конвертации
- Обработка ошибок валидации

✅ **Web интерфейс**
- Отображение страниц
- AJAX запросы
- JSON ответы
- Обработка HTTP ошибок

✅ **Системные функции**
- Проверка доступности FFmpeg
- Получение информации о видео
- Статус системы конвертации

## Моки и заглушки

В тестах используются моки для:
- **MoviePy** - для изоляции от внешних зависимостей
- **FFmpeg** - для контроля subprocess вызовов
- **Файловые операции** - для тестирования без реальных файлов
- **HTTP запросы** - для тестирования web интерфейса

## Тестовые данные

Используются:
- Фиктивные видеофайлы (байтовые последовательности)
- Временные файлы и директории
- Мок-объекты для сложных структур данных
- Предустановленные настройки конвертации

## Обработка ошибок в тестах

Тесты проверяют:
- ImportError при отсутствии MoviePy
- FileNotFoundError при отсутствии FFmpeg
- ValidationError при неверных данных форм
- TimeoutError при долгих операциях
- Различные HTTP ошибки

## Настройка тестовой среды

```python
# Переопределение настроек для тестов
@override_settings(
    MEDIA_ROOT='/tmp/test_media',
    MEDIA_URL='/test_media/',
    FFMPEG_BINARY='ffmpeg'
)
```

## Непрерывная интеграция

Тесты подготовлены для запуска в CI/CD:
- Автоматическая настройка тестовой базы данных
- Изоляция временных файлов
- Детерминированные результаты
- Отсутствие внешних зависимостей

## Отладка тестов

Для отладки сложных тестов:
```bash
python manage.py test converter.tests.VideoConverterTests.test_convert_with_moviepy_success -v 2 --debug-mode
```

## Требования для тестов

- Python 3.8+
- Django 5.2.5
- Все зависимости из requirements.txt
- Достаточное место на диске для временных файлов
