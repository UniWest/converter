{% extends 'converter/base.html' %}
{% load i18n %}

{% block title %}
    {% get_current_language as LANGUAGE_CODE %}
    {% if LANGUAGE_CODE == 'en' %}
        Audio to Text Converter - Speech Recognition
    {% else %}
        –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –∞—É–¥–∏–æ –≤ —Ç–µ–∫—Å—Ç - –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏
    {% endif %}
{% endblock %}

{% block extra_css %}
<style>
/* –°–∫—Ä—ã–≤–∞–µ–º —è–∑—ã–∫–æ–≤–æ–π —Å–µ–ª–µ–∫—Ç–æ—Ä –Ω–∞ —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ */
#languageDropdown {
    display: none !important;
}

.dropdown.position-absolute {
    display: none !important;
}

/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è audio-to-text */
.audio-drop-zone {
    position: relative;
    overflow: hidden;
    border: 3px dashed var(--border-purple);
    border-radius: var(--border-radius-lg);
    padding: 3rem 2rem;
    text-align: center;
    transition: var(--transition-bounce);
    background: var(--gradient-card);
    cursor: pointer;
    backdrop-filter: blur(5px);
    min-height: 200px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

.audio-drop-zone:hover,
.audio-drop-zone.drag-over {
    border-color: var(--border-hover);
    background: var(--bg-purple-lighter);
    transform: translateY(-5px) scale(1.02);
    box-shadow: var(--shadow-hover);
}

.audio-drop-zone input[type=file] {
    position: absolute;
    left: -9999px;
    opacity: 0;
}

.audio-icon {
    font-size: 4rem;
    color: var(--primary-purple);
    margin-bottom: 1.5rem;
    transition: var(--transition-normal);
}

.audio-drop-zone:hover .audio-icon {
    transform: scale(1.1) rotateZ(5deg);
    color: var(--secondary-purple);
}

.settings-panel {
    background: var(--gradient-card);
    border-radius: var(--border-radius-lg);
    padding: 2rem;
    margin: 2rem 0;
    border-left: 5px solid var(--primary-purple);
    transition: var(--transition-normal);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.settings-panel:hover {
    background: var(--bg-purple-lighter);
    transform: translateX(5px);
    box-shadow: var(--shadow-light);
}

.result-panel {
    background: rgba(255, 255, 255, 0.9);
    border-radius: var(--border-radius-lg);
    padding: 2rem;
    margin-top: 2rem;
    border: 1px solid var(--border-light);
    backdrop-filter: blur(10px);
    transition: var(--transition-normal);
}

.result-panel:hover {
    background: white;
    box-shadow: var(--shadow-light);
}

.progress-container {
    margin: 1.5rem 0;
    display: none;
}

.progress-container.show {
    display: block;
    animation: fadeIn 0.3s ease-in-out;
}

.download-buttons {
    margin-top: 1rem;
    display: none;
}

.download-buttons.show {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
    animation: slideInUp 0.5s ease-in-out;
}

@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.file-info {
    background: var(--bg-purple-light);
    border-radius: var(--border-radius-md);
    padding: 1rem;
    margin-top: 1rem;
    border: 1px solid var(--border-light);
    display: none;
}

.file-info.show {
    display: block;
    animation: fadeIn 0.3s ease-in-out;
}

.status-indicator {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.9rem;
    padding: 0.5rem 1rem;
    border-radius: var(--border-radius-md);
    margin-top: 1rem;
}

.status-indicator.processing {
    background: rgba(255, 193, 7, 0.1);
    color: #856404;
    border: 1px solid rgba(255, 193, 7, 0.3);
}

.status-indicator.completed {
    background: rgba(25, 135, 84, 0.1);
    color: #0f5132;
    border: 1px solid rgba(25, 135, 84, 0.3);
}

.status-indicator.error {
    background: rgba(220, 53, 69, 0.1);
    color: #721c24;
    border: 1px solid rgba(220, 53, 69, 0.3);
}

.language-toggle {
    position: fixed;
    top: 20px;
    left: 20px;
    z-index: 1000;
}

/* Advanced settings styles */
.advanced-settings-panel {
    background: rgba(138, 43, 226, 0.05);
    border-radius: var(--border-radius-md);
    padding: 1.5rem;
    margin-top: 1rem;
    border: 1px solid rgba(138, 43, 226, 0.2);
    transition: var(--transition-normal);
}

.advanced-settings-panel.show {
    animation: slideInDown 0.3s ease-in-out;
}

.range-container {
    position: relative;
}

.form-range {
    margin-bottom: 0.5rem;
}

.form-range::-webkit-slider-thumb {
    background: var(--primary-purple);
    border-radius: 50%;
    cursor: pointer;
}

.form-range::-moz-range-thumb {
    background: var(--primary-purple);
    border-radius: 50%;
    cursor: pointer;
    border: none;
}

.form-range:focus {
    outline: none;
    box-shadow: 0 0 0 0.25rem rgba(138, 43, 226, 0.25);
}

@keyframes slideInDown {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Range value indicators */
.range-container .text-muted {
    font-size: 0.8rem;
}

/* Dark theme text color overrides */
[data-theme="dark"] .file-info {
    color: var(--text-primary);
}

[data-theme="dark"] .file-info p,
[data-theme="dark"] .file-info h6 {
    color: var(--text-primary) !important;
}

[data-theme="dark"] .settings-panel,
[data-theme="dark"] .settings-panel * {
    color: var(--text-primary) !important;
}

[data-theme="dark"] .form-label,
[data-theme="dark"] .form-check-label {
    color: var(--text-primary) !important;
}

[data-theme="dark"] .text-muted {
    color: rgba(255, 255, 255, 0.7) !important;
}

[data-theme="dark"] .audio-drop-zone h5,
[data-theme="dark"] .audio-drop-zone p {
    color: var(--text-primary) !important;
}

[data-theme="dark"] .result-panel {
    background: rgba(17, 24, 39, 0.9) !important;
    color: var(--text-primary) !important;
}

[data-theme="dark"] .result-panel h5,
[data-theme="dark"] .result-panel span,
[data-theme="dark"] .result-panel small {
    color: var(--text-primary) !important;
}

[data-theme="dark"] #resultText {
    background: rgba(31, 41, 55, 0.9) !important;
    color: var(--text-primary) !important;
    border-color: rgba(55, 65, 81, 0.6) !important;
}

[data-theme="dark"] .feature-card {
    color: var(--text-primary) !important;
}

[data-theme="dark"] .feature-card h5,
[data-theme="dark"] .feature-card p {
    color: var(--text-primary) !important;
}

/* Auto dark theme text colors */
@media (prefers-color-scheme: dark) {
    :root:not([data-theme="light"]) .file-info {
        color: var(--text-primary);
    }
    
    :root:not([data-theme="light"]) .file-info p,
    :root:not([data-theme="light"]) .file-info h6 {
        color: var(--text-primary) !important;
    }
    
    :root:not([data-theme="light"]) .settings-panel,
    :root:not([data-theme="light"]) .settings-panel * {
        color: var(--text-primary) !important;
    }
    
    :root:not([data-theme="light"]) .form-label,
    :root:not([data-theme="light"]) .form-check-label {
        color: var(--text-primary) !important;
    }
    
    :root:not([data-theme="light"]) .text-muted {
        color: rgba(255, 255, 255, 0.7) !important;
    }
    
    :root:not([data-theme="light"]) .audio-drop-zone h5,
    :root:not([data-theme="light"]) .audio-drop-zone p {
        color: var(--text-primary) !important;
    }
    
    :root:not([data-theme="light"]) .result-panel {
        background: rgba(17, 24, 39, 0.9) !important;
        color: var(--text-primary) !important;
    }
    
    :root:not([data-theme="light"]) .result-panel h5,
    :root:not([data-theme="light"]) .result-panel span,
    :root:not([data-theme="light"]) .result-panel small {
        color: var(--text-primary) !important;
    }
    
    :root:not([data-theme="light"]) #resultText {
        background: rgba(31, 41, 55, 0.9) !important;
        color: var(--text-primary) !important;
        border-color: rgba(55, 65, 81, 0.6) !important;
    }
    
    :root:not([data-theme="light"]) .feature-card {
        color: var(--text-primary) !important;
    }
    
    :root:not([data-theme="light"]) .feature-card h5,
    :root:not([data-theme="light"]) .feature-card p {
        color: var(--text-primary) !important;
    }
}

/* Responsive improvements */
@media (max-width: 768px) {
    .download-buttons {
        justify-content: center;
    }
    
    .audio-drop-zone {
        padding: 2rem 1rem;
        min-height: 150px;
    }
    
    .audio-icon {
        font-size: 2.5rem;
    }
    
    .settings-panel {
        padding: 1.5rem;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-10 mx-auto">
        <!-- System Status Alert -->
        <div class="alert alert-warning alert-dismissible fade show" role="alert" id="systemStatusAlert">
            <i class="bi bi-exclamation-triangle-fill"></i>
            <strong>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏:</strong>
            –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã. 
            –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ.
            <a href="#" class="alert-link" onclick="showLibraryInfo()">–ü–æ–¥—Ä–æ–±–Ω–µ–µ ¬ª</a>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        
        <!-- File Upload Zone -->
        <div class="audio-drop-zone fade-in" id="dropZone">
            <div class="audio-icon" id="uploadIcon">üéµ</div>
            <h5 id="uploadTitle" class="mb-2">{% trans "–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∞—É–¥–∏–æ—Ñ–∞–π–ª" %}</h5>
            <p class="text-muted mb-3" id="uploadSubtitle">
                {% get_current_language as LANGUAGE_CODE %}
                {% if LANGUAGE_CODE == 'en' %}
                    Click here or drag and drop audio file
                {% else %}
                    –ù–∞–∂–º–∏—Ç–µ –∑–¥–µ—Å—å –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∞—É–¥–∏–æ—Ñ–∞–π–ª
                {% endif %}
            </p>
            <p class="file-name text-primary fw-bold" id="fileName">
                {% get_current_language as LANGUAGE_CODE %}
                {% if LANGUAGE_CODE == 'en' %}
                    No file selected
                {% else %}
                    –§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω
                {% endif %}
            </p>
            <input type="file" id="audioInput" accept="audio/*,.mp3,.wav,.m4a,.aac,.ogg,.flac,.wma">
        </div>
        
        <!-- File Info -->
        <div class="file-info" id="fileInfo">
            <h6 id="fileInfoTitle">
                {% get_current_language as LANGUAGE_CODE %}
                {% if LANGUAGE_CODE == 'en' %}
                    File Information
                {% else %}
                    –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∞–π–ª–µ
                {% endif %}
            </h6>
            <div id="fileInfoContent"></div>
        </div>
        
        <!-- Settings Panel -->
        <div class="settings-panel slide-in-left">
            <h5 class="mb-3">
                <i class="bi bi-gear-fill"></i>
                <span id="settingsTitle">
                    {% get_current_language as LANGUAGE_CODE %}
                    {% if LANGUAGE_CODE == 'en' %}
                        Recognition Settings
                    {% else %}
                        –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
                    {% endif %}
                </span>
            </h5>
            
            <div class="row">
                <!-- Speech Recognition Engine -->
                <div class="col-md-4 mb-3">
                    <label class="form-label" for="sttEngine" id="engineLabel">
                        {% get_current_language as LANGUAGE_CODE %}
                        {% if LANGUAGE_CODE == 'en' %}
                            Recognition Engine
                        {% else %}
                            –î–≤–∏–∂–æ–∫ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
                        {% endif %}
                    </label>
                    <select id="sttEngine" class="form-select">
                        <option value="whisper" selected>OpenAI Whisper</option>
                        <option value="google">Google Speech</option>
                        <option value="yandex">Yandex SpeechKit</option>
                        <option value="vosk">Vosk (Offline)</option>
                    </select>
                </div>
                
                <!-- Language -->
                <div class="col-md-4 mb-3">
                    <label class="form-label" for="sttLanguage" id="languageLabel">
                        {% get_current_language as LANGUAGE_CODE %}
                        {% if LANGUAGE_CODE == 'en' %}
                            Recognition Language
                        {% else %}
                            –Ø–∑—ã–∫ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
                        {% endif %}
                    </label>
                    <select id="sttLanguage" class="form-select">
                        <option value="ru-RU" selected>üá∑üá∫ –†—É—Å—Å–∫–∏–π</option>
                        <option value="en-US">üá∫üá∏ English</option>
                        <option value="uk-UA">üá∫üá¶ –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</option>
                        <option value="de-DE">üá©üá™ Deutsch</option>
                        <option value="fr-FR">üá´üá∑ Fran√ßais</option>
                        <option value="es-ES">üá™üá∏ Espa√±ol</option>
                        <option value="it-IT">üáÆüáπ Italiano</option>
                        <option value="ja-JP">üáØüáµ Êó•Êú¨Ë™û</option>
                        <option value="ko-KR">üá∞üá∑ ÌïúÍµ≠Ïñ¥</option>
                        <option value="zh-CN">üá®üá≥ ‰∏≠Êñá</option>
                    </select>
                </div>
                
                <!-- Quality -->
                <div class="col-md-4 mb-3">
                    <label class="form-label" for="sttQuality" id="qualityLabel">
                        {% get_current_language as LANGUAGE_CODE %}
                        {% if LANGUAGE_CODE == 'en' %}
                            Quality
                        {% else %}
                            –ö–∞—á–µ—Å—Ç–≤–æ
                        {% endif %}
                    </label>
                    <select id="sttQuality" class="form-select">
                        <option value="standard" selected>
                            {% get_current_language as LANGUAGE_CODE %}
                            {% if LANGUAGE_CODE == 'en' %}
                                Standard
                            {% else %}
                                –û–±—ã—á–Ω–æ–µ
                            {% endif %}
                        </option>
                        <option value="high">
                            {% get_current_language as LANGUAGE_CODE %}
                            {% if LANGUAGE_CODE == 'en' %}
                                High (slower)
                            {% else %}
                                –í—ã—Å–æ–∫–æ–µ (–º–µ–¥–ª–µ–Ω–Ω–µ–µ)
                            {% endif %}
                        </option>
                        <option value="fast">
                            {% get_current_language as LANGUAGE_CODE %}
                            {% if LANGUAGE_CODE == 'en' %}
                                Fast (less accurate)
                            {% else %}
                                –ë—ã—Å—Ç—Ä–æ–µ (–º–µ–Ω–µ–µ —Ç–æ—á–Ω–æ)
                            {% endif %}
                        </option>
                    </select>
                </div>
            </div>
            
            <!-- Advanced Audio Settings -->
            <div class="row">
                <div class="col-12 mb-3">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="advancedSettings">
                        <label class="form-check-label fw-bold" for="advancedSettings" id="advancedLabel">
                            {% get_current_language as LANGUAGE_CODE %}
                            {% if LANGUAGE_CODE == 'en' %}
                                üéõÔ∏è Advanced Audio Settings
                            {% else %}
                                üéõÔ∏è –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞—É–¥–∏–æ
                            {% endif %}
                        </label>
                    </div>
                </div>
            </div>
            
            <!-- Advanced Settings Panel -->
            <div class="row advanced-settings-panel" id="advancedPanel" style="display: none;">
                <div class="col-md-4 mb-3">
                    <label class="form-label" for="volumeGain" id="volumeLabel">
                        {% get_current_language as LANGUAGE_CODE %}
                        {% if LANGUAGE_CODE == 'en' %}
                            üîä Volume Gain
                        {% else %}
                            üîä –£—Å–∏–ª–µ–Ω–∏–µ –≥—Ä–æ–º–∫–æ—Å—Ç–∏
                        {% endif %}
                    </label>
                    <div class="range-container">
                        <input type="range" class="form-range" id="volumeGain" min="0" max="200" value="100" step="5">
                        <div class="d-flex justify-content-between small text-muted">
                            <span>0%</span>
                            <span id="volumeValue">100%</span>
                            <span>200%</span>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-4 mb-3">
                    <label class="form-label" for="bassBoost" id="bassLabel">
                        {% get_current_language as LANGUAGE_CODE %}
                        {% if LANGUAGE_CODE == 'en' %}
                            üéµ Bass Boost
                        {% else %}
                            üéµ –£—Å–∏–ª–µ–Ω–∏–µ –±–∞—Å–æ–≤
                        {% endif %}
                    </label>
                    <div class="range-container">
                        <input type="range" class="form-range" id="bassBoost" min="-20" max="20" value="0" step="1">
                        <div class="d-flex justify-content-between small text-muted">
                            <span>-20dB</span>
                            <span id="bassValue">0dB</span>
                            <span>+20dB</span>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-4 mb-3">
                    <label class="form-label" for="trebleBoost" id="trebleLabel">
                        {% get_current_language as LANGUAGE_CODE %}
                        {% if LANGUAGE_CODE == 'en' %}
                            üéº Treble Boost
                        {% else %}
                            üéº –£—Å–∏–ª–µ–Ω–∏–µ –≤—ã—Å–æ–∫–∏—Ö
                        {% endif %}
                    </label>
                    <div class="range-container">
                        <input type="range" class="form-range" id="trebleBoost" min="-20" max="20" value="0" step="1">
                        <div class="d-flex justify-content-between small text-muted">
                            <span>-20dB</span>
                            <span id="trebleValue">0dB</span>
                            <span>+20dB</span>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6 mb-3">
                    <label class="form-label" for="noiseReduction" id="noiseLabel">
                        {% get_current_language as LANGUAGE_CODE %}
                        {% if LANGUAGE_CODE == 'en' %}
                            üîá Noise Reduction
                        {% else %}
                            üîá –®—É–º–æ–ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ
                        {% endif %}
                    </label>
                    <select id="noiseReduction" class="form-select">
                        <option value="none" selected>
                            {% get_current_language as LANGUAGE_CODE %}
                            {% if LANGUAGE_CODE == 'en' %}
                                None
                            {% else %}
                                –û—Ç–∫–ª—é—á–µ–Ω–æ
                            {% endif %}
                        </option>
                        <option value="light">
                            {% get_current_language as LANGUAGE_CODE %}
                            {% if LANGUAGE_CODE == 'en' %}
                                Light
                            {% else %}
                                –õ–µ–≥–∫–æ–µ
                            {% endif %}
                        </option>
                        <option value="moderate">
                            {% get_current_language as LANGUAGE_CODE %}
                            {% if LANGUAGE_CODE == 'en' %}
                                Moderate
                            {% else %}
                                –£–º–µ—Ä–µ–Ω–Ω–æ–µ
                            {% endif %}
                        </option>
                        <option value="aggressive">
                            {% get_current_language as LANGUAGE_CODE %}
                            {% if LANGUAGE_CODE == 'en' %}
                                Aggressive
                            {% else %}
                                –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ
                            {% endif %}
                        </option>
                    </select>
                </div>
                
                <div class="col-md-6 mb-3">
                    <label class="form-label" for="normalization" id="normalizationLabel">
                        {% get_current_language as LANGUAGE_CODE %}
                        {% if LANGUAGE_CODE == 'en' %}
                            üìä Audio Normalization
                        {% else %}
                            üìä –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∞—É–¥–∏–æ
                        {% endif %}
                    </label>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="enableNormalization">
                        <label class="form-check-label" for="enableNormalization" id="enableNormalizationLabel">
                            {% get_current_language as LANGUAGE_CODE %}
                            {% if LANGUAGE_CODE == 'en' %}
                                Enable automatic normalization
                            {% else %}
                                –í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é
                            {% endif %}
                        </label>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <!-- Output Format -->
                <div class="col-md-6 mb-3">
                    <label class="form-label" id="formatLabel">
                        {% get_current_language as LANGUAGE_CODE %}
                        {% if LANGUAGE_CODE == 'en' %}
                            Output Format
                        {% else %}
                            –§–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞
                        {% endif %}
                    </label>
                    <div class="btn-group w-100" role="group" id="formatToggle">
                        <input type="radio" class="btn-check" name="outputFormat" id="formatText" value="text" checked>
                        <label class="btn btn-outline-primary" for="formatText">üìù TXT</label>
                        
                        <input type="radio" class="btn-check" name="outputFormat" id="formatSrt" value="srt">
                        <label class="btn btn-outline-primary" for="formatSrt">üé¨ SRT</label>
                        
                        <input type="radio" class="btn-check" name="outputFormat" id="formatJson" value="json">
                        <label class="btn btn-outline-primary" for="formatJson">üìä JSON</label>
                    </div>
                </div>
                
                <!-- Additional Options -->
                <div class="col-md-6 mb-3">
                    <label class="form-label" id="optionsLabel">
                        {% get_current_language as LANGUAGE_CODE %}
                        {% if LANGUAGE_CODE == 'en' %}
                            Additional Options
                        {% else %}
                            –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏
                        {% endif %}
                    </label>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="includeTimestamps">
                        <label class="form-check-label" for="includeTimestamps" id="timestampsLabel">
                            {% get_current_language as LANGUAGE_CODE %}
                            {% if LANGUAGE_CODE == 'en' %}
                                Include timestamps
                            {% else %}
                                –í–∫–ª—é—á–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏
                            {% endif %}
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="detectSpeakers">
                        <label class="form-check-label" for="detectSpeakers" id="speakersLabel">
                            {% get_current_language as LANGUAGE_CODE %}
                            {% if LANGUAGE_CODE == 'en' %}
                                Detect speakers (experimental)
                            {% else %}
                                –û–ø—Ä–µ–¥–µ–ª—è—Ç—å —Å–ø–∏–∫–µ—Ä–æ–≤ (—ç–∫—Å–ø.)
                            {% endif %}
                        </label>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Start Recognition Button -->
        <div class="text-center slide-in-right">
            <button type="button" class="btn btn-primary btn-lg" id="startRecognition">
                <i class="bi bi-mic-fill"></i>
                <span id="recognizeButton">
                    {% get_current_language as LANGUAGE_CODE %}
                    {% if LANGUAGE_CODE == 'en' %}
                        Start Recognition
                    {% else %}
                        –ù–∞—á–∞—Ç—å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ
                    {% endif %}
                </span>
            </button>
        </div>
        
        <!-- Progress Bar -->
        <div class="progress-container" id="progressContainer">
            <div class="d-flex justify-content-between align-items-center mb-2">
                <span id="progressLabel">
                    {% get_current_language as LANGUAGE_CODE %}
                    {% if LANGUAGE_CODE == 'en' %}
                        Processing audio...
                    {% else %}
                        –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞—É–¥–∏–æ...
                    {% endif %}
                </span>
                <span id="progressPercent">0%</span>
            </div>
            <div class="progress">
                <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" 
                     id="progressBar" style="width: 0%"></div>
            </div>
            <div class="status-indicator processing" id="statusIndicator" style="display: none;">
                <div class="spinner-border spinner-border-sm" role="status"></div>
                <span id="statusText">
                    {% get_current_language as LANGUAGE_CODE %}
                    {% if LANGUAGE_CODE == 'en' %}
                        Processing...
                    {% else %}
                        –û–±—Ä–∞–±–æ—Ç–∫–∞...
                    {% endif %}
                </span>
            </div>
        </div>
        
        <!-- Results Panel -->
        <div class="result-panel" id="resultPanel" style="display: none;">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="mb-0">
                    <i class="bi bi-file-text"></i>
                    <span id="resultTitle">
                        {% get_current_language as LANGUAGE_CODE %}
                        {% if LANGUAGE_CODE == 'en' %}
                            Recognition Result
                        {% else %}
                            –†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
                        {% endif %}
                    </span>
                </h5>
                <div class="download-buttons" id="downloadButtons">
                    <button class="btn btn-outline-primary btn-sm" onclick="downloadResult('txt')">
                        <i class="bi bi-download"></i> TXT
                    </button>
                    <button class="btn btn-outline-primary btn-sm" onclick="downloadResult('srt')">
                        <i class="bi bi-download"></i> SRT
                    </button>
                    <button class="btn btn-outline-primary btn-sm" onclick="downloadResult('json')">
                        <i class="bi bi-download"></i> JSON
                    </button>
                    <button class="btn btn-outline-secondary btn-sm" onclick="copyToClipboard()">
                        <i class="bi bi-clipboard"></i>
                        <span id="copyButton">
                            {% get_current_language as LANGUAGE_CODE %}
                            {% if LANGUAGE_CODE == 'en' %}
                                Copy
                            {% else %}
                                –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                            {% endif %}
                        </span>
                    </button>
                </div>
            </div>
            
            <textarea id="resultText" class="form-control" rows="12" 
                      placeholder="–†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å" 
                      readonly></textarea>
            
            <div class="mt-3">
                <small class="text-muted" id="resultInfo"></small>
            </div>
        </div>
        
        <!-- Error Alert -->
        <div class="alert alert-danger mt-3" id="errorAlert" style="display: none;" role="alert">
            <i class="bi bi-exclamation-triangle-fill"></i>
            <span id="errorMessage"></span>
        </div>
    </div>
</div>

<!-- Additional Information Cards -->
<div class="row mt-5">
    <div class="col-md-4">
        <div class="feature-card fade-in">
            <div class="feature-icon">üéØ</div>
            <h5 id="accuracyTitle">
                {% get_current_language as LANGUAGE_CODE %}
                {% if LANGUAGE_CODE == 'en' %}
                    High Accuracy
                {% else %}
                    –í—ã—Å–æ–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å
                {% endif %}
            </h5>
            <p class="text-muted mb-0" id="accuracyDesc">
                {% get_current_language as LANGUAGE_CODE %}
                {% if LANGUAGE_CODE == 'en' %}
                    Advanced AI models for precise speech recognition in multiple languages
                {% else %}
                    –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –ò–ò –º–æ–¥–µ–ª–∏ –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏ –Ω–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ —è–∑—ã–∫–æ–≤
                {% endif %}
            </p>
        </div>
    </div>
    <div class="col-md-4">
        <div class="feature-card fade-in">
            <div class="feature-icon">üìÅ</div>
            <h5 id="formatsTitle">
                {% get_current_language as LANGUAGE_CODE %}
                {% if LANGUAGE_CODE == 'en' %}
                    Multiple Formats
                {% else %}
                    –ú–Ω–æ–∂–µ—Å—Ç–≤–æ —Ñ–æ—Ä–º–∞—Ç–æ–≤
                {% endif %}
            </h5>
            <p class="text-muted mb-0" id="formatsDesc">
                {% get_current_language as LANGUAGE_CODE %}
                {% if LANGUAGE_CODE == 'en' %}
                    Support for MP3, WAV, M4A, AAC, OGG, FLAC, WMA and other audio formats
                {% else %}
                    –ü–æ–¥–¥–µ—Ä–∂–∫–∞ MP3, WAV, M4A, AAC, OGG, FLAC, WMA –∏ –¥—Ä—É–≥–∏—Ö –∞—É–¥–∏–æ —Ñ–æ—Ä–º–∞—Ç–æ–≤
                {% endif %}
            </p>
        </div>
    </div>
    <div class="col-md-4">
        <div class="feature-card fade-in">
            <div class="feature-icon">‚ö°</div>
            <h5 id="speedTitle">
                {% get_current_language as LANGUAGE_CODE %}
                {% if LANGUAGE_CODE == 'en' %}
                    Fast Processing
                {% else %}
                    –ë—ã—Å—Ç—Ä–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
                {% endif %}
            </h5>
            <p class="text-muted mb-0" id="speedDesc">
                {% get_current_language as LANGUAGE_CODE %}
                {% if LANGUAGE_CODE == 'en' %}
                    Optimized algorithms for quick speech-to-text conversion
                {% else %}
                    –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Ä–µ—á–∏ –≤ —Ç–µ–∫—Å—Ç
                {% endif %}
            </p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
let currentLanguage = 'ru';
let recognitionTaskId = null;
let progressInterval = null;
let recognitionResult = null;

// –¢–µ–∫—Å—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —è–∑—ã–∫–æ–≤
const translations = {
    ru: {
        uploadTitle: '–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∞—É–¥–∏–æ—Ñ–∞–π–ª',
        uploadSubtitle: '–ù–∞–∂–º–∏—Ç–µ –∑–¥–µ—Å—å –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∞—É–¥–∏–æ—Ñ–∞–π–ª',
        noFileSelected: '–§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω',
        fileInfo: '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∞–π–ª–µ',
        settingsTitle: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è',
        engineLabel: '–î–≤–∏–∂–æ–∫ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è',
        languageLabel: '–Ø–∑—ã–∫ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è',
        qualityLabel: '–ö–∞—á–µ—Å—Ç–≤–æ',
        formatLabel: '–§–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞',
        optionsLabel: '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏',
        timestampsLabel: '–í–∫–ª—é—á–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏',
        speakersLabel: '–û–ø—Ä–µ–¥–µ–ª—è—Ç—å —Å–ø–∏–∫–µ—Ä–æ–≤ (—ç–∫—Å–ø.)',
        recognizeButton: '–ù–∞—á–∞—Ç—å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ',
        progressLabel: '–û–±—Ä–∞–±–æ—Ç–∫–∞ –∞—É–¥–∏–æ...',
        statusProcessing: '–û–±—Ä–∞–±–æ—Ç–∫–∞...',
        resultTitle: '–†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è',
        copyButton: '–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å',
        resultPlaceholder: '–†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å',
        accuracyTitle: '–í—ã—Å–æ–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å',
        accuracyDesc: '–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –ò–ò –º–æ–¥–µ–ª–∏ –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏ –Ω–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ —è–∑—ã–∫–æ–≤',
        formatsTitle: '–ú–Ω–æ–∂–µ—Å—Ç–≤–æ —Ñ–æ—Ä–º–∞—Ç–æ–≤',
        formatsDesc: '–ü–æ–¥–¥–µ—Ä–∂–∫–∞ MP3, WAV, M4A, AAC, OGG, FLAC, WMA –∏ –¥—Ä—É–≥–∏—Ö –∞—É–¥–∏–æ —Ñ–æ—Ä–º–∞—Ç–æ–≤',
        speedTitle: '–ë—ã—Å—Ç—Ä–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞',
        speedDesc: '–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Ä–µ—á–∏ –≤ —Ç–µ–∫—Å—Ç',
        // –ö–∞—á–µ—Å—Ç–≤–æ
        qualityStandard: '–û–±—ã—á–Ω–æ–µ',
        qualityHigh: '–í—ã—Å–æ–∫–æ–µ (–º–µ–¥–ª–µ–Ω–Ω–µ–µ)',
        qualityFast: '–ë—ã—Å—Ç—Ä–æ–µ (–º–µ–Ω–µ–µ —Ç–æ—á–Ω–æ)',
        // –û—à–∏–±–∫–∏ –∏ —Å–æ–æ–±—â–µ–Ω–∏—è
        errorNoFile: '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∞—É–¥–∏–æ—Ñ–∞–π–ª',
        errorFileSize: '–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 100 –ú–ë',
        errorFileType: '–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞',
        successCopied: '–¢–µ–∫—Å—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞',
        statusCompleted: '–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ',
        statusError: '–û—à–∏–±–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è'
    },
    en: {
        uploadTitle: 'Upload Audio File',
        uploadSubtitle: 'Click here or drag and drop audio file',
        noFileSelected: 'No file selected',
        fileInfo: 'File Information',
        settingsTitle: 'Recognition Settings',
        engineLabel: 'Recognition Engine',
        languageLabel: 'Recognition Language',
        qualityLabel: 'Quality',
        formatLabel: 'Output Format',
        optionsLabel: 'Additional Options',
        timestampsLabel: 'Include timestamps',
        speakersLabel: 'Detect speakers (experimental)',
        recognizeButton: 'Start Recognition',
        progressLabel: 'Processing audio...',
        statusProcessing: 'Processing...',
        resultTitle: 'Recognition Result',
        copyButton: 'Copy',
        resultPlaceholder: 'Recognition result will appear here',
        accuracyTitle: 'High Accuracy',
        accuracyDesc: 'Advanced AI models for precise speech recognition in multiple languages',
        formatsTitle: 'Multiple Formats',
        formatsDesc: 'Support for MP3, WAV, M4A, AAC, OGG, FLAC, WMA and other audio formats',
        speedTitle: 'Fast Processing',
        speedDesc: 'Optimized algorithms for quick speech-to-text conversion',
        // –ö–∞—á–µ—Å—Ç–≤–æ
        qualityStandard: 'Standard',
        qualityHigh: 'High (slower)',
        qualityFast: 'Fast (less accurate)',
        // –û—à–∏–±–∫–∏ –∏ —Å–æ–æ–±—â–µ–Ω–∏—è
        errorNoFile: 'Please select an audio file',
        errorFileSize: 'File is too large. Maximum size: 100 MB',
        errorFileType: 'Unsupported file format',
        successCopied: 'Text copied to clipboard',
        statusCompleted: 'Recognition completed',
        statusError: 'Recognition error'
    }
};

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â–∏–π —è–∑—ã–∫ –∏–∑ URL –∏–ª–∏ localStorage
    const urlParams = new URLSearchParams(window.location.search);
    const langFromUrl = urlParams.get('lang');
    const langFromStorage = localStorage.getItem('audioToTextLang');
    
    currentLanguage = langFromUrl || langFromStorage || 'ru';
    updateLanguage(currentLanguage);
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
    initDragAndDrop();
    initFileInput();
    initRecognitionButton();
    initLanguageToggle();
    initAdvancedSettings();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É —è–∑—ã–∫–∞
    document.getElementById('lang-' + currentLanguage).classList.add('active');
});

// –§—É–Ω–∫—Ü–∏—è —Å–º–µ–Ω—ã —è–∑—ã–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
function setLanguage(lang) {
    currentLanguage = lang;
    localStorage.setItem('audioToTextLang', lang);
    updateLanguage(lang);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
    document.querySelectorAll('.language-toggle .btn').forEach(btn => {
        btn.classList.remove('active');
        btn.classList.remove('btn-primary');
        btn.classList.add('btn-outline-primary');
    });
    
    const activeButton = document.getElementById('lang-' + lang);
    if (activeButton) {
        activeButton.classList.remove('btn-outline-primary');
        activeButton.classList.add('btn-primary', 'active');
    }
    
    // –¢–∞–∫–∂–µ –æ–±–Ω–æ–≤–ª—è–µ–º —è–∑—ã–∫ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –≤ —Å–µ–ª–µ–∫—Ç–æ—Ä–µ
    const sttLanguageSelect = document.getElementById('sttLanguage');
    if (sttLanguageSelect) {
        if (lang === 'ru') {
            sttLanguageSelect.value = 'ru-RU';
        } else if (lang === 'en') {
            sttLanguageSelect.value = 'en-US';
        }
    }
    
    console.log('Language changed to:', lang);
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
function updateLanguage(lang) {
    const t = translations[lang];
    if (!t) return;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å –ø–µ—Ä–µ–≤–æ–¥–∞–º–∏
    const elements = {
        'uploadTitle': 'textContent',
        'uploadSubtitle': 'textContent',
        'fileName': 'textContent',
        'fileInfoTitle': 'textContent',
        'settingsTitle': 'textContent',
        'engineLabel': 'textContent',
        'languageLabel': 'textContent',
        'qualityLabel': 'textContent',
        'formatLabel': 'textContent',
        'optionsLabel': 'textContent',
        'timestampsLabel': 'textContent',
        'speakersLabel': 'textContent',
        'recognizeButton': 'textContent',
        'progressLabel': 'textContent',
        'statusText': 'textContent',
        'resultTitle': 'textContent',
        'copyButton': 'textContent',
        'resultText': 'placeholder',
        'accuracyTitle': 'textContent',
        'accuracyDesc': 'textContent',
        'formatsTitle': 'textContent',
        'formatsDesc': 'textContent',
        'speedTitle': 'textContent',
        'speedDesc': 'textContent'
    };
    
    Object.entries(elements).forEach(([id, prop]) => {
        const element = document.getElementById(id);
        if (element && t[id]) {
            element[prop] = t[id];
        }
    });
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –æ–ø—Ü–∏–∏ –∫–∞—á–µ—Å—Ç–≤–∞
    const qualitySelect = document.getElementById('sttQuality');
    if (qualitySelect) {
        qualitySelect.options[0].textContent = t.qualityStandard;
        qualitySelect.options[1].textContent = t.qualityHigh;
        qualitySelect.options[2].textContent = t.qualityFast;
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º placeholder –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
    const fileName = document.getElementById('fileName');
    if (fileName && fileName.textContent.includes('No file') || fileName.textContent.includes('–§–∞–π–ª –Ω–µ')) {
        fileName.textContent = t.noFileSelected;
    }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Drag & Drop
function initDragAndDrop() {
    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('audioInput');
    
    // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        dropZone.addEventListener(eventName, preventDefaults, false);
        document.body.addEventListener(eventName, preventDefaults, false);
    });
    
    // –í—ã–¥–µ–ª—è–µ–º –∑–æ–Ω—É –ø—Ä–∏ –¥—Ä–∞–≥–µ
    ['dragenter', 'dragover'].forEach(eventName => {
        dropZone.addEventListener(eventName, highlight, false);
    });
    
    ['dragleave', 'drop'].forEach(eventName => {
        dropZone.addEventListener(eventName, unhighlight, false);
    });
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥—Ä–æ–ø–∞
    dropZone.addEventListener('drop', handleDrop, false);
    
    // –ö–ª–∏–∫ –ø–æ –∑–æ–Ω–µ = –∫–ª–∏–∫ –ø–æ input
    dropZone.addEventListener('click', () => fileInput.click());
    
    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }
    
    function highlight() {
        dropZone.classList.add('drag-over');
    }
    
    function unhighlight() {
        dropZone.classList.remove('drag-over');
    }
    
    function handleDrop(e) {
        const files = e.dataTransfer.files;
        if (files.length > 0) {
            fileInput.files = files;
            handleFileSelect(files[0]);
        }
    }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è input —Ñ–∞–π–ª–∞
function initFileInput() {
    const fileInput = document.getElementById('audioInput');
    fileInput.addEventListener('change', function(e) {
        if (e.target.files.length > 0) {
            handleFileSelect(e.target.files[0]);
        }
    });
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
function handleFileSelect(file) {
    const t = translations[currentLanguage];
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–∞
    if (!validateFile(file)) {
        return;
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–º—è —Ñ–∞–π–ª–∞
    document.getElementById('fileName').textContent = file.name;
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∞–π–ª–µ
    showFileInfo(file);
    
    // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    hideResults();
    hideError();
}

// –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–∞
function validateFile(file) {
    const t = translations[currentLanguage];
        const maxSize = 100 * 1024 * 1024; // 100 MB
    const allowedTypes = [
        'audio/mpeg', 'audio/mp3', 'audio/wav', 'audio/wave', 'audio/x-wav',
        'audio/m4a', 'audio/x-m4a', 'audio/aac', 'audio/ogg', 'audio/flac',
        'audio/wma', 'audio/webm'
    ];
    
    const allowedExtensions = ['.mp3', '.wav', '.m4a', '.aac', '.ogg', '.flac', '.wma'];
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞
    if (file.size > maxSize) {
        showError(t.errorFileSize);
        return false;
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
    const isValidType = allowedTypes.includes(file.type) || 
                       allowedExtensions.some(ext => file.name.toLowerCase().endsWith(ext));
    
    if (!isValidType) {
        showError(t.errorFileType);
        return false;
    }
    
    return true;
}

// –ü–æ–∫–∞–∑ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ñ–∞–π–ª–µ
function showFileInfo(file) {
    const fileInfo = document.getElementById('fileInfo');
    const fileInfoContent = document.getElementById('fileInfoContent');
    
    const sizeInMB = (file.size / (1024 * 1024)).toFixed(2);
    const lastModified = new Date(file.lastModified).toLocaleString();
    
    fileInfoContent.innerHTML = `
        <p><strong>${currentLanguage === 'en' ? 'Name' : '–ò–º—è'}:</strong> ${file.name}</p>
        <p><strong>${currentLanguage === 'en' ? 'Size' : '–†–∞–∑–º–µ—Ä'}:</strong> ${sizeInMB} ${currentLanguage === 'en' ? 'MB' : '–ú–ë'}</p>
        <p><strong>${currentLanguage === 'en' ? 'Type' : '–¢–∏–ø'}:</strong> ${file.type || 'unknown'}</p>
        <p><strong>${currentLanguage === 'en' ? 'Last modified' : '–ò–∑–º–µ–Ω–µ–Ω'}:</strong> ${lastModified}</p>
    `;
    
    fileInfo.classList.add('show');
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
function initRecognitionButton() {
    const startButton = document.getElementById('startRecognition');
    startButton.addEventListener('click', startRecognition);
}

// –ó–∞–ø—É—Å–∫ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
async function startRecognition() {
    const t = translations[currentLanguage];
    const fileInput = document.getElementById('audioInput');
    const file = fileInput.files[0];
    
    if (!file) {
        showError(t.errorNoFile);
        return;
    }
    
    // –ü–æ–ª—É—á–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    const settings = getRecognitionSettings();
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
    showProgress();
    
    // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
    const formData = new FormData();
    formData.append('audio', file);
    formData.append('engine', settings.engine);
    formData.append('language', settings.language);
    formData.append('quality', settings.quality);
    formData.append('output_format', settings.outputFormat);
    formData.append('include_timestamps', settings.includeTimestamps);
    formData.append('detect_speakers', settings.detectSpeakers);
    
    // –î–æ–±–∞–≤–ª—è–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞—É–¥–∏–æ –µ—Å–ª–∏ –æ–Ω–∏ –≤–∫–ª—é—á–µ–Ω—ã
    if (settings.volumeGain !== undefined) formData.append('volume_gain', settings.volumeGain);
    if (settings.bassBoost !== undefined) formData.append('bass_boost', settings.bassBoost);
    if (settings.trebleBoost !== undefined) formData.append('treble_boost', settings.trebleBoost);
    if (settings.noiseReduction !== undefined) formData.append('noise_reduction', settings.noiseReduction);
    if (settings.enableNormalization !== undefined) formData.append('enable_normalization', settings.enableNormalization);
    
    try {
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å
        const response = await fetch('/app/api/audio-to-text/', {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': getCsrfToken()
            }
        });
        
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        // –°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        const responseText = await response.text();
        console.log('Raw response text:', responseText);
        
        // –ü–∞—Ä—Å–∏–º JSON
        let result;
        try {
            result = JSON.parse(responseText);
        } catch (e) {
            console.error('Failed to parse JSON:', e);
            console.error('Response text:', responseText);
            throw new Error('Invalid JSON response from server');
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
        console.log('Response result:', result);
        console.log('Result type:', typeof result);
        console.log('Result keys:', Object.keys(result || {}));
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥–æ–µ –ø–æ–ª–µ
        console.log('result.success:', result?.success);
        console.log('result.text:', result?.text);
        console.log('result.metadata:', result?.metadata);
        console.log('result.error:', result?.error);
        
        if (result.success) {
            // –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ
            console.log('Recognition successful, text:', result.text);
            console.log('Recognition metadata:', result.metadata);
            recognitionResult = result;
            showResults(result);
            hideProgress();
            showStatusIndicator('completed', t.statusCompleted);
        } else {
            console.error('Recognition failed:', result.error);
            throw new Error(result.error || 'Unknown error');
        }
        
    } catch (error) {
        console.error('Recognition error:', error);
        showError(error.message || error.toString());
        hideProgress();
        showStatusIndicator('error', t.statusError);
    }
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
function getRecognitionSettings() {
    const settings = {
        engine: document.getElementById('sttEngine').value,
        language: document.getElementById('sttLanguage').value,
        quality: document.getElementById('sttQuality').value,
        outputFormat: document.querySelector('input[name="outputFormat"]:checked').value,
        includeTimestamps: document.getElementById('includeTimestamps').checked,
        detectSpeakers: document.getElementById('detectSpeakers').checked
    };
    
    // Add advanced audio settings if the panel is enabled
    const advancedEnabled = document.getElementById('advancedSettings').checked;
    if (advancedEnabled) {
        settings.volumeGain = document.getElementById('volumeGain').value;
        settings.bassBoost = document.getElementById('bassBoost').value;
        settings.trebleBoost = document.getElementById('trebleBoost').value;
        settings.noiseReduction = document.getElementById('noiseReduction').value;
        settings.enableNormalization = document.getElementById('enableNormalization').checked;
    }
    
    return settings;
}

// –ü–æ–∫–∞–∑ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
function showProgress() {
    const progressContainer = document.getElementById('progressContainer');
    const startButton = document.getElementById('startRecognition');
    const progressBar = document.getElementById('progressBar');
    const progressPercent = document.getElementById('progressPercent');
    
    progressContainer.classList.add('show');
    startButton.disabled = true;
    
    // –°–∏–º—É–ª—è—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ (–º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞)
    let progress = 0;
    progressInterval = setInterval(() => {
        progress += Math.random() * 15;
        if (progress > 95) progress = 95;
        
        progressBar.style.width = progress + '%';
        progressPercent.textContent = Math.round(progress) + '%';
    }, 500);
    
    showStatusIndicator('processing', translations[currentLanguage].statusProcessing);
}

// –°–∫—Ä—ã—Ç–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
function hideProgress() {
    const progressContainer = document.getElementById('progressContainer');
    const startButton = document.getElementById('startRecognition');
    const progressBar = document.getElementById('progressBar');
    const progressPercent = document.getElementById('progressPercent');
    
    progressContainer.classList.remove('show');
    startButton.disabled = false;
    
    if (progressInterval) {
        clearInterval(progressInterval);
        progressInterval = null;
    }
    
    // –ó–∞–≤–µ—Ä—à–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –Ω–∞ 100%
    progressBar.style.width = '100%';
    progressPercent.textContent = '100%';
    
    setTimeout(() => {
        progressBar.style.width = '0%';
        progressPercent.textContent = '0%';
    }, 1000);
}

// –ü–æ–∫–∞–∑ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ —Å—Ç–∞—Ç—É—Å–∞
function showStatusIndicator(type, message) {
    const statusIndicator = document.getElementById('statusIndicator');
    const statusText = document.getElementById('statusText');
    
    statusIndicator.className = 'status-indicator ' + type;
    statusText.textContent = message;
    statusIndicator.style.display = 'inline-flex';
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
    setTimeout(() => {
        statusIndicator.style.display = 'none';
    }, 5000);
}

// –ü–æ–∫–∞–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
function showResults(result) {
    console.log('showResults called with:', result);
    
    const resultPanel = document.getElementById('resultPanel');
    const resultText = document.getElementById('resultText');
    const downloadButtons = document.getElementById('downloadButtons');
    const resultInfo = document.getElementById('resultInfo');
    
    console.log('Elements found:', {
        resultPanel: !!resultPanel,
        resultText: !!resultText,
        downloadButtons: !!downloadButtons,
        resultInfo: !!resultInfo
    });
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    resultPanel.style.display = 'block';
    console.log('Panel displayed, result text to show:', result.text);
    
    // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–µ–∫—Å—Ç
    resultText.value = result.text || '';
    console.log('Text area value set to:', resultText.value);
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
    downloadButtons.classList.add('show');
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
    if (result.metadata) {
        const duration = result.metadata.duration ? `${result.metadata.duration}s` : 'N/A';
        const language = result.metadata.language || 'N/A';
        const confidence = result.metadata.confidence ? `${Math.round(result.metadata.confidence * 100)}%` : 'N/A';
        
        resultInfo.innerHTML = `
            ${currentLanguage === 'en' ? 'Duration' : '–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å'}: ${duration} | 
            ${currentLanguage === 'en' ? 'Language' : '–Ø–∑—ã–∫'}: ${language} | 
            ${currentLanguage === 'en' ? 'Confidence' : '–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å'}: ${confidence}
        `;
    }
    
    // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º
    resultPanel.scrollIntoView({ behavior: 'smooth' });
}

// –°–∫—Ä—ã—Ç–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
function hideResults() {
    const resultPanel = document.getElementById('resultPanel');
    const downloadButtons = document.getElementById('downloadButtons');
    
    resultPanel.style.display = 'none';
    downloadButtons.classList.remove('show');
    recognitionResult = null;
}

// –ü–æ–∫–∞–∑ –æ—à–∏–±–∫–∏
function showError(message) {
    const errorAlert = document.getElementById('errorAlert');
    const errorMessage = document.getElementById('errorMessage');
    
    errorMessage.textContent = message;
    errorAlert.style.display = 'block';
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥
    setTimeout(() => {
        hideError();
    }, 10000);
}

// –°–∫—Ä—ã—Ç–∏–µ –æ—à–∏–±–∫–∏
function hideError() {
    const errorAlert = document.getElementById('errorAlert');
    errorAlert.style.display = 'none';
}

// –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö
function downloadResult(format) {
    if (!recognitionResult) {
        showError(translations[currentLanguage].errorNoResult || 'No recognition result available');
        return;
    }
    
    let content, filename, mimeType;
    const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, '-');
    
    switch (format) {
        case 'txt':
            content = recognitionResult.text || '';
            filename = `speech-recognition_${timestamp}.txt`;
            mimeType = 'text/plain';
            break;
            
        case 'srt':
            content = generateSrtContent(recognitionResult);
            filename = `speech-recognition_${timestamp}.srt`;
            mimeType = 'application/x-subrip';
            break;
            
        case 'json':
            content = JSON.stringify(recognitionResult, null, 2);
            filename = `speech-recognition_${timestamp}.json`;
            mimeType = 'application/json';
            break;
            
        default:
            return;
    }
    
    // –°–æ–∑–¥–∞–µ–º –∏ —Å–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª
    const blob = new Blob([content], { type: mimeType + ';charset=utf-8' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SRT –∫–æ–Ω—Ç–µ–Ω—Ç–∞
function generateSrtContent(result) {
    if (!result.segments || !Array.isArray(result.segments)) {
        // –ï—Å–ª–∏ –Ω–µ—Ç —Å–µ–≥–º–µ–Ω—Ç–æ–≤, —Å–æ–∑–¥–∞–µ–º –æ–¥–∏–Ω —Å–µ–≥–º–µ–Ω—Ç –Ω–∞ –≤–µ—Å—å —Ç–µ–∫—Å—Ç
        return `1\n00:00:00,000 --> 00:00:10,000\n${result.text || ''}\n\n`;
    }
    
    return result.segments.map((segment, index) => {
        const start = formatTime(segment.start || 0);
        const end = formatTime(segment.end || segment.start + 5);
        return `${index + 1}\n${start} --> ${end}\n${segment.text || ''}\n`;
    }).join('\n');
}

// –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è SRT
function formatTime(seconds) {
    const hours = Math.floor(seconds / 3600);
    const minutes = Math.floor((seconds % 3600) / 60);
    const secs = Math.floor(seconds % 60);
    const ms = Math.floor((seconds % 1) * 1000);
    
    return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')},${ms.toString().padStart(3, '0')}`;
}

// –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
async function copyToClipboard() {
    const resultText = document.getElementById('resultText');
    const t = translations[currentLanguage];
    
    if (!resultText.value) {
        return;
    }
    
    try {
        await navigator.clipboard.writeText(resultText.value);
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        const copyButton = document.querySelector('button[onclick="copyToClipboard()"]');
        const originalText = copyButton.innerHTML;
        
        copyButton.innerHTML = '<i class="bi bi-check"></i> ' + t.successCopied;
        copyButton.classList.add('btn-success');
        copyButton.classList.remove('btn-outline-secondary');
        
        setTimeout(() => {
            copyButton.innerHTML = originalText;
            copyButton.classList.remove('btn-success');
            copyButton.classList.add('btn-outline-secondary');
        }, 2000);
        
    } catch (err) {
        // Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
        resultText.select();
        document.execCommand('copy');
    }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è —è–∑—ã–∫–æ–≤
function initLanguageToggle() {
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ HTML —á–µ—Ä–µ–∑ onclick
    // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É –∑–¥–µ—Å—å –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∞—É–¥–∏–æ
function initAdvancedSettings() {
    const advancedToggle = document.getElementById('advancedSettings');
    const advancedPanel = document.getElementById('advancedPanel');
    const volumeGain = document.getElementById('volumeGain');
    const bassBoost = document.getElementById('bassBoost');
    const trebleBoost = document.getElementById('trebleBoost');
    const volumeValue = document.getElementById('volumeValue');
    const bassValue = document.getElementById('bassValue');
    const trebleValue = document.getElementById('trebleValue');
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
    advancedToggle.addEventListener('change', function() {
        if (this.checked) {
            advancedPanel.style.display = 'flex';
            advancedPanel.classList.add('show');
        } else {
            advancedPanel.style.display = 'none';
            advancedPanel.classList.remove('show');
        }
    });
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏–π —Å–ª–∞–π–¥–µ—Ä–æ–≤
    volumeGain.addEventListener('input', function() {
        volumeValue.textContent = this.value + '%';
        console.log('Volume gain changed to:', this.value + '%');
    });
    
    bassBoost.addEventListener('input', function() {
        const value = this.value;
        bassValue.textContent = (value >= 0 ? '+' : '') + value + 'dB';
        console.log('Bass boost changed to:', value + 'dB');
    });
    
    trebleBoost.addEventListener('input', function() {
        const value = this.value;
        trebleValue.textContent = (value >= 0 ? '+' : '') + value + 'dB';
        console.log('Treble boost changed to:', value + 'dB');
    });
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —à—É–º–æ–ø–æ–¥–∞–≤–ª–µ–Ω–∏—è
    document.getElementById('noiseReduction').addEventListener('change', function() {
        console.log('Noise reduction changed to:', this.value);
    });
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏
    document.getElementById('enableNormalization').addEventListener('change', function() {
        console.log('Audio normalization:', this.checked ? 'enabled' : 'disabled');
    });
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ CSRF —Ç–æ–∫–µ–Ω–∞
function getCsrfToken() {
    return document.querySelector('[name=csrfmiddlewaretoken]')?.value || 
           document.querySelector('meta[name=csrf-token]')?.getAttribute('content') || 
           '';
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ –≤—ã–≤–æ–¥–∞
document.addEventListener('change', function(e) {
    if (e.target.name === 'outputFormat') {
        // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤
        console.log('Output format changed to:', e.target.value);
    }
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–≤–∏–∂–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
document.addEventListener('change', function(e) {
    if (e.target.id === 'sttEngine') {
        // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥–≤–∏–∂–∫–∞
        console.log('Recognition engine changed to:', e.target.value);
    }
});

// –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã
function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

function formatDuration(seconds) {
    const minutes = Math.floor(seconds / 60);
    const remainingSeconds = Math.floor(seconds % 60);
    return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ö
function showLibraryInfo() {
    const modalHtml = `
        <div class="modal fade" id="libraryInfoModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">
                            <i class="bi bi-info-circle"></i>
                            –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="alert alert-info">
                            <h6><i class="bi bi-exclamation-triangle-fill"></i> –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã</h6>
                            <p>–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∂–∏–º–µ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–º–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º–∏:</p>
                            <ul>
                                <li><strong>Celery:</strong> –ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞</li>
                                <li><strong>pydub:</strong> –ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω - –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∞—É–¥–∏–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞</li>
                                <li><strong>speech_recognition:</strong> –ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω - —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ</li>
                            </ul>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <h6><i class="bi bi-check-circle text-success"></i> –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç</h6>
                                <ul>
                                    <li>–ó–∞–≥—Ä—É–∑–∫–∞ –∞—É–¥–∏–æ—Ñ–∞–π–ª–æ–≤</li>
                                    <li>–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</li>
                                    <li>–ë–∞–∑–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º</li>
                                    <li>–°–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6><i class="bi bi-x-circle text-danger"></i> –ß—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç</h6>
                                <ul>
                                    <li>–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏ –∏–∑ –∞—É–¥–∏–æ</li>
                                    <li>–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤</li>
                                    <li>–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∞—É–¥–∏–æ</li>
                                    <li>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—É–±—Ç–∏—Ç—Ä–æ–≤</li>
                                </ul>
                            </div>
                        </div>
                        
                        <hr>
                        
                        <h6><i class="bi bi-tools"></i> –î–ª—è –ø–æ–ª–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ:</h6>
                        <div class="bg-dark text-light p-3 rounded">
                            <code>
                                pip install celery[redis]<br>
                                pip install pydub<br>
                                pip install SpeechRecognition<br>
                                pip install ffmpeg-python
                            </code>
                        </div>
                        
                        <div class="mt-3">
                            <small class="text-muted">
                                <i class="bi bi-lightbulb"></i>
                                <strong>–°–æ–≤–µ—Ç:</strong> –ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Django —Å–µ—Ä–≤–µ—Ä –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π.
                            </small>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –º–æ–¥–∞–ª –µ—Å–ª–∏ –µ—Å—Ç—å
    const existingModal = document.getElementById('libraryInfoModal');
    if (existingModal) {
        existingModal.remove();
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º –º–æ–¥–∞–ª –≤ DOM
    document.body.insertAdjacentHTML('beforeend', modalHtml);
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª
    const modal = new bootstrap.Modal(document.getElementById('libraryInfoModal'));
    modal.show();
    
    // –£–¥–∞–ª—è–µ–º –º–æ–¥–∞–ª –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è
    document.getElementById('libraryInfoModal').addEventListener('hidden.bs.modal', function() {
        this.remove();
    });
}

// –≠–∫—Å–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
window.audioToTextApp = {
    setLanguage,
    downloadResult,
    copyToClipboard,
    startRecognition,
    showLibraryInfo
};
</script>
{% endblock %}
