{% extends 'converter/base.html' %}

{% block title %}–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä —Ñ–∞–π–ª–æ–≤{% endblock %}

{% block extra_css %}
<style>
    /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ (–∫–æ–º–ø–∞–∫—Ç–Ω–µ–µ) */
    .converter-card {
        transition: all 0.2s ease;
        border: 1px solid #e9ecef;
        border-radius: 12px;
        padding: 1rem 1rem;
        height: 100%;
    }

    .converter-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        border-color: var(--bs-primary);
    }

    .converter-card.active {
        border-color: var(--bs-primary);
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }

    .file-type-icon {
        font-size: 3rem;
        margin-bottom: 1rem;
        opacity: 0.8;
    }

    .upload-zone {
        border: 2px dashed #dee2e6;
        border-radius: 12px;
        padding: 1.25rem;
        text-align: center;
        transition: all 0.2s ease;
        background: #f8f9fa;
        min-height: 140px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }

    .upload-zone.dragover {
        border-color: var(--bs-primary);
        background: rgba(13, 110, 253, 0.1);
    }

    .upload-zone.has-files {
        border-color: var(--bs-success);
        background: rgba(25, 135, 84, 0.1);
    }

    .conversion-progress {
        display: none;
        margin-top: 2rem;
    }

    .progress-step {
        display: flex;
        align-items: center;
        margin: 1rem 0;
        padding: 1rem;
        border-radius: 10px;
        background: #f8f9fa;
    }

    .progress-step.active {
        background: rgba(13, 110, 253, 0.1);
        border-left: 4px solid var(--bs-primary);
    }

    .progress-step.completed {
        background: rgba(25, 135, 84, 0.1);
        border-left: 4px solid var(--bs-success);
    }

    .settings-panel {
        background: white;
        border-radius: 12px;
        padding: 1rem 1rem;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.06);
        margin-top: 1rem;
        display: none;
    }

    .settings-panel.active {
        display: block;
        animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .file-list {
        max-height: 300px;
        overflow-y: auto;
    }

    .file-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 1rem;
        border: 1px solid #dee2e6;
        border-radius: 10px;
        margin-bottom: 0.5rem;
        background: white;
    }

    .file-info {
        display: flex;
        align-items: center;
        flex-grow: 1;
    }

    .file-icon {
        margin-right: 1rem;
        font-size: 1.5rem;
    }

    .status-indicator {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-left: 1rem;
    }

    .status-pending {
        background-color: #ffc107;
    }

    .status-processing {
        background-color: #0d6efd;
        animation: pulse 1s infinite;
    }

    .status-completed {
        background-color: #198754;
    }

    .status-error {
        background-color: #dc3545;
    }

    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
    }

    .results-gallery {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 1rem;
        margin-top: 2rem;
    }

    .result-card {
        border: 1px solid #dee2e6;
        border-radius: 15px;
        padding: 1rem;
        text-align: center;
        background: white;
        transition: transform 0.3s ease;
    }

    .result-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .result-preview {
        width: 100%;
        height: 150px;
        object-fit: cover;
        border-radius: 10px;
        margin-bottom: 1rem;
        background: #f8f9fa;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #6c757d;
        font-size: 3rem;
    }

    .adapter-status {
        margin-top: 2rem;
        padding: 1rem;
        border-radius: 10px;
        background: #f8f9fa;
    }

    .engine-status {
        display: flex;
        align-items: center;
        margin: 0.5rem 0;
    }

    .engine-status .badge {
        margin-left: auto;
    }

    .conversion-stats {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 12px;
        padding: 1rem;
        text-align: center;
        margin: 1rem 0;
    }

    .stat-item {
        margin: 1rem;
    }

    .stat-number {
        font-size: 2.5rem;
        font-weight: bold;
        display: block;
    }

    .stat-label {
        font-size: 0.9rem;
        opacity: 0.9;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div class="row mb-4">
        <div class="col-12 text-center">
            <h1 class="display-4 mb-3">üîÑ –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä —Ñ–∞–π–ª–æ–≤</h1>
            <p class="lead text-muted">
                –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–π—Ç–µ –≤–∏–¥–µ–æ, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –∞—É–¥–∏–æ, –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏ –∞—Ä—Ö–∏–≤—ã —Å –ø–æ–º–æ—â—å—é —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤
            </p>
        </div>
    </div>

    <!-- –í—ã–±–æ—Ä —Ç–∏–ø–∞ –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä–∞ (–∫–∞—Ä—Ç–æ—á–∫–∏ —Å—Ç–∞—Ä–æ–≥–æ –¥–∏–∑–∞–π–Ω–∞) -->
    <div class="row mb-3" id="converter-types">
        <div class="col-md-2 col-sm-4 col-6 mb-3">
            <div class="converter-card text-center h-100" data-type="video">
                <div class="file-type-icon">üé•</div>
                <h5>–í–∏–¥–µ–æ</h5>
                <p class="small">MP4, AVI, MOV –≤ GIF</p>
                <div class="mt-auto">
                    <small class="text-muted">–ü–æ–¥–¥–µ—Ä–∂–∫–∞ MoviePy/FFmpeg</small>
                </div>
            </div>
        </div>
        
        <div class="col-md-2 col-sm-4 col-6 mb-3">
            <div class="converter-card text-center h-100" data-type="image">
                <div class="file-type-icon">üñºÔ∏è</div>
                <h5>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</h5>
                <p class="small">JPG, PNG, GIF, WebP</p>
                <div class="mt-auto">
                    <small class="text-muted">–ü–æ–¥–¥–µ—Ä–∂–∫–∞ PIL/Pillow</small>
                </div>
            </div>
        </div>
        
        <div class="col-md-2 col-sm-4 col-6 mb-3">
            <div class="converter-card text-center h-100" data-type="audio">
                <div class="file-type-icon">üéµ</div>
                <h5>–ê—É–¥–∏–æ</h5>
                <p class="small">MP3, WAV + Speech-to-Text</p>
                <div class="mt-auto">
                    <small class="text-muted">–ü–æ–¥–¥–µ—Ä–∂–∫–∞ Whisper/PyDub</small>
                </div>
            </div>
        </div>
        
        <div class="col-md-2 col-sm-4 col-6 mb-3">
            <div class="converter-card text-center h-100" data-type="document">
                <div class="file-type-icon">üìÑ</div>
                <h5>–î–æ–∫—É–º–µ–Ω—Ç—ã</h5>
                <p class="small">PDF, DOCX, RTF</p>
                <div class="mt-auto">
                    <small class="text-muted">–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</small>
                </div>
            </div>
        </div>
        
        <div class="col-md-2 col-sm-4 col-6 mb-3">
            <div class="converter-card text-center h-100" data-type="archive">
                <div class="file-type-icon">üóúÔ∏è</div>
                <h5>–ê—Ä—Ö–∏–≤—ã</h5>
                <p class="small">ZIP, RAR, 7Z</p>
                <div class="mt-auto">
                    <small class="text-muted">–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</small>
                </div>
            </div>
        </div>
        
        <div class="col-md-2 col-sm-4 col-6 mb-3">
            <div class="converter-card text-center h-100" data-type="batch">
                <div class="file-type-icon">‚ö°</div>
                <h5>–ü–∞–∫–µ—Ç–Ω–∞—è</h5>
                <p class="small">–ú–Ω–æ–∂–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤</p>
                <div class="mt-auto">
                    <small class="text-muted">–ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ</small>
                </div>
            </div>
        </div>
    </div>

    <!-- –ó–æ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ -->
    <div class="row">
        <div class="col-12">
            <div class="upload-zone" id="upload-zone">
                <div class="upload-content">
                    <div style="font-size: 4rem; margin-bottom: 1rem;">üìÅ</div>
                    <h4>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã —Å—é–¥–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</h4>
                    <p class="text-muted">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏ —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã</p>
                    <input type="file" id="file-input" multiple style="display: none;" accept="*/*">
                    <button type="button" class="btn btn-primary btn-lg mt-3" onclick="document.getElementById('file-input').click()">
                        <i class="bi bi-upload"></i> –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª—ã
                    </button>
                </div>
                
                <div class="file-list mt-4" id="file-list"></div>
            </div>
        </div>
    </div>

    <!-- –ü–∞–Ω–µ–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ -->
    <div id="settings-panels">
        <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∏–¥–µ–æ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ -->
        <div class="settings-panel" id="video-settings">
            <h5><i class="bi bi-gear-fill"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤–∏–¥–µ–æ</h5>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="video-width" class="form-label">–®–∏—Ä–∏–Ω–∞ (–ø–∏–∫—Å–µ–ª–∏)</label>
                        <select class="form-select" id="video-width">
                            <option value="">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é</option>
                            <option value="320">320px (–º–∏–Ω–∏)</option>
                            <option value="480">480px (–º–æ–±–∏–ª—å–Ω–æ–µ)</option>
                            <option value="720" selected>720px (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ)</option>
                            <option value="1080">1080px (HD)</option>
                        </select>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="video-fps" class="form-label">FPS (–∫–∞–¥—Ä–æ–≤/—Å–µ–∫)</label>
                        <select class="form-select" id="video-fps">
                            <option value="10">10 fps (–Ω–∏–∑–∫–æ–µ)</option>
                            <option value="15" selected>15 fps (–æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ)</option>
                            <option value="20">20 fps (—Ö–æ—Ä–æ—à–µ–µ)</option>
                            <option value="30">30 fps (–≤—ã—Å–æ–∫–æ–µ)</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="video-start-time" class="form-label">–ù–∞—á–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è (—Å–µ–∫)</label>
                        <input type="number" class="form-control" id="video-start-time" min="0" value="0">
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="video-end-time" class="form-label">–ö–æ–Ω–µ—á–Ω–æ–µ –≤—Ä–µ–º—è (—Å–µ–∫)</label>
                        <input type="number" class="form-control" id="video-end-time" min="1" placeholder="–î–æ –∫–æ–Ω—Ü–∞ –≤–∏–¥–µ–æ">
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-4">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="video-grayscale">
                        <label class="form-check-label" for="video-grayscale">
                            –ß–µ—Ä–Ω–æ-–±–µ–ª–æ–µ
                        </label>
                    </div>
                </div>
                
                <div class="col-md-4">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="video-reverse">
                        <label class="form-check-label" for="video-reverse">
                            –†–µ–≤–µ—Ä—Å
                        </label>
                    </div>
                </div>
                
                <div class="col-md-4">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="video-boomerang">
                        <label class="form-check-label" for="video-boomerang">
                            –ë—É–º–µ—Ä–∞–Ω–≥
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π -->
        <div class="settings-panel" id="image-settings">
            <h5><i class="bi bi-gear-fill"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</h5>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="image-width" class="form-label">–®–∏—Ä–∏–Ω–∞</label>
                        <input type="number" class="form-control" id="image-width" min="1" placeholder="–ê–≤—Ç–æ">
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="image-height" class="form-label">–í—ã—Å–æ—Ç–∞</label>
                        <input type="number" class="form-control" id="image-height" min="1" placeholder="–ê–≤—Ç–æ">
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="image-format" class="form-label">–í—ã—Ö–æ–¥–Ω–æ–π —Ñ–æ—Ä–º–∞—Ç</label>
                        <select class="form-select" id="image-format">
                            <option value="">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–π</option>
                            <option value="jpg">JPEG</option>
                            <option value="png">PNG</option>
                            <option value="webp">WebP</option>
                            <option value="gif">GIF</option>
                        </select>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="image-quality" class="form-label">–ö–∞—á–µ—Å—Ç–≤–æ (–¥–ª—è JPEG)</label>
                        <input type="range" class="form-range" id="image-quality" min="1" max="100" value="90">
                        <span id="quality-value">90%</span>
                    </div>
                </div>
            </div>
            
            <!-- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–æ–∑–¥–∞–Ω–∏—è –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ GIF -->
            <div id="gif-animation-params" style="display: none;">
                <hr>
                <h6><i class="bi bi-magic"></i> –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∞–Ω–∏–º–∞—Ü–∏–∏ GIF</h6>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="create-animated-gif">
                            <label class="form-check-label" for="create-animated-gif">
                                –°–æ–∑–¥–∞—Ç—å –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π GIF –∏–∑ —Å—Ç–∞—Ç–∏—á–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                            </label>
                        </div>
                    </div>
                </div>
                
                <div id="gif-settings" style="display: none;">
                    <div class="row mt-3">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="gif-effect" class="form-label">–≠—Ñ—Ñ–µ–∫—Ç –∞–Ω–∏–º–∞—Ü–∏–∏</label>
                                <select class="form-select" id="gif-effect">
                                    <option value="none">–ë–µ–∑ —ç—Ñ—Ñ–µ–∫—Ç–∞</option>
                                    <option value="fade" selected>Fade (–∑–∞—Ç—É—Ö–∞–Ω–∏–µ)</option>
                                    <option value="zoom">Zoom (–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ)</option>
                                    <option value="rotate">Rotate (–≤—Ä–∞—â–µ–Ω–∏–µ)</option>
                                    <option value="bounce">Bounce (–ø—Ä—ã–∂–∫–∏)</option>
                                    <option value="pan-left">Pan Left (–ø–∞–Ω–æ—Ä–∞–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–ª–µ–≤–æ)</option>
                                    <option value="pan-right">Pan Right (–ø–∞–Ω–æ—Ä–∞–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–ø—Ä–∞–≤–æ)</option>
                                    <option value="pan-up">Pan Up (–ø–∞–Ω–æ—Ä–∞–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–≤–µ—Ä—Ö)</option>
                                    <option value="pan-down">Pan Down (–ø–∞–Ω–æ—Ä–∞–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–Ω–∏–∑)</option>
                                    <option value="shake">Shake (—Ç—Ä—è—Å–∫–∞)</option>
                                    <option value="blur">Blur (—Ä–∞–∑–º—ã—Ç–∏–µ)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="gif-duration" class="form-label">–°–∫–æ—Ä–æ—Å—Ç—å (–º—Å/–∫–∞–¥—Ä)</label>
                                <input type="range" class="form-range" id="gif-duration" min="50" max="1000" value="200">
                                <span id="gif-duration-value">200–º—Å</span>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="gif-frames" class="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–¥—Ä–æ–≤</label>
                                <input type="range" class="form-range" id="gif-frames" min="5" max="30" value="10">
                                <span id="gif-frames-value">10</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="gif-loop" checked>
                                <label class="form-check-label" for="gif-loop">
                                    –ë–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-info mt-3">
                    <i class="bi bi-info-circle"></i>
                    <strong>–°–æ–≤–µ—Ç:</strong> –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ GIF —Å–æ–∑–¥–∞—é—Ç—Å—è –ø—É—Ç–µ–º –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞ –∫ —Å—Ç–∞—Ç–∏—á–Ω–æ–º—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é.
                    –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Ä–∞–∑–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤!
                </div>
            </div>
        </div>

        <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞—É–¥–∏–æ -->
        <div class="settings-panel" id="audio-settings">
            <h5><i class="bi bi-gear-fill"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞—É–¥–∏–æ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏</h5>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="audio-action" class="form-label">–î–µ–π—Å—Ç–≤–∏–µ</label>
                        <select class="form-select" id="audio-action">
                            <option value="convert" selected>–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç</option>
                            <option value="speech-to-text">–†–∞—Å–ø–æ–∑–Ω–∞—Ç—å —Ä–µ—á—å ‚Üí –¢–µ–∫—Å—Ç</option>
                            <option value="extract-from-video">–ò–∑–≤–ª–µ—á—å –∏–∑ –≤–∏–¥–µ–æ</option>
                        </select>
                    </div>
                </div>
                
                <div class="col-md-6" id="audio-output-format-group">
                    <div class="mb-3">
                        <label for="audio-output-format" class="form-label">–í—ã—Ö–æ–¥–Ω–æ–π —Ñ–æ—Ä–º–∞—Ç</label>
                        <select class="form-select" id="audio-output-format">
                            <option value="mp3" selected>MP3</option>
                            <option value="wav">WAV</option>
                            <option value="flac">FLAC</option>
                            <option value="aac">AAC</option>
                            <option value="ogg">OGG</option>
                            <option value="opus">Opus</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –∞—É–¥–∏–æ -->
            <div id="audio-convert-params">
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="audio-bitrate" class="form-label">–ë–∏—Ç—Ä–µ–π—Ç</label>
                            <select class="form-select" id="audio-bitrate">
                                <option value="128k">128 kbps</option>
                                <option value="192k" selected>192 kbps</option>
                                <option value="256k">256 kbps</option>
                                <option value="320k">320 kbps</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="audio-sample-rate" class="form-label">–ß–∞—Å—Ç–æ—Ç–∞ –¥–∏—Å–∫—Ä–µ—Ç–∏–∑–∞—Ü–∏–∏</label>
                            <select class="form-select" id="audio-sample-rate">
                                <option value="">–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è</option>
                                <option value="22050">22.05 kHz</option>
                                <option value="44100">44.1 kHz</option>
                                <option value="48000">48 kHz</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="audio-normalize">
                            <label class="form-check-label" for="audio-normalize">
                                –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–æ–º–∫–æ—Å—Ç–∏
                            </label>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="mb-3">
                            <label for="audio-channels" class="form-label">–ö–∞–Ω–∞–ª—ã</label>
                            <select class="form-select" id="audio-channels">
                                <option value="">–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ</option>
                                <option value="1">–ú–æ–Ω–æ</option>
                                <option value="2">–°—Ç–µ—Ä–µ–æ</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="mb-3">
                            <label for="audio-volume" class="form-label">–ò–∑–º–µ–Ω–µ–Ω–∏–µ –≥—Ä–æ–º–∫–æ—Å—Ç–∏ (–¥–ë)</label>
                            <input type="range" class="form-range" id="audio-volume" min="-20" max="20" value="0">
                            <span id="audio-volume-value">0 –¥–ë</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏ -->
            <div id="speech-to-text-params" style="display: none;">
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="stt-language" class="form-label">–Ø–∑—ã–∫ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è</label>
                            <select class="form-select" id="stt-language">
                                <option value="ru" selected>–†—É—Å—Å–∫–∏–π</option>
                                <option value="en">English</option>
                                <option value="de">Deutsch</option>
                                <option value="fr">Fran√ßais</option>
                                <option value="es">Espa√±ol</option>
                                <option value="auto">–ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="stt-engine" class="form-label">–î–≤–∏–∂–æ–∫ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è</label>
                            <select class="form-select" id="stt-engine">
                                <option value="whisper" selected>Whisper (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)</option>
                                <option value="speech_recognition">Google Speech API</option>
                                <option value="auto">–ê–≤—Ç–æ–≤—ã–±–æ—Ä</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="stt-output-format" class="form-label">–§–æ—Ä–º–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞</label>
                            <select class="form-select" id="stt-output-format">
                                <option value="txt" selected>–û–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç (.txt)</option>
                                <option value="json">JSON —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏</option>
                                <option value="srt">–°—É–±—Ç–∏—Ç—Ä—ã SRT</option>
                                <option value="vtt">–°—É–±—Ç–∏—Ç—Ä—ã WebVTT</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="whisper-model-size" class="form-label">–†–∞–∑–º–µ—Ä –º–æ–¥–µ–ª–∏ Whisper</label>
                            <select class="form-select" id="whisper-model-size">
                                <option value="tiny">Tiny (–±—ã—Å—Ç—Ä–æ, –Ω–∏–∑–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å)</option>
                                <option value="base" selected>Base (–±–∞–ª–∞–Ω—Å)</option>
                                <option value="small">Small (–º–µ–¥–ª–µ–Ω–Ω–æ, —Ö–æ—Ä–æ—à–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å)</option>
                                <option value="medium">Medium (–æ—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω–æ, –≤—ã—Å–æ–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å)</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="stt-timestamps">
                            <label class="form-check-label" for="stt-timestamps">
                                –î–æ–±–∞–≤–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-info mt-3">
                    <i class="bi bi-info-circle"></i>
                    <strong>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong> –î–ª—è —Ä–∞–±–æ—Ç—ã —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏ —Ç—Ä–µ–±—É—é—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏:
                    <ul class="mb-0 mt-2">
                        <li><code>pip install openai-whisper</code> - –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞</li>
                        <li><code>pip install SpeechRecognition</code> - –∫–∞–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="settings-panel" id="document-settings">
            <h5><i class="bi bi-gear-fill"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)</h5>
            <p class="text-muted">–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–∏—Ö –≤–µ—Ä—Å–∏—è—Ö.</p>
        </div>

        <div class="settings-panel" id="archive-settings">
            <h5><i class="bi bi-gear-fill"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞—Ä—Ö–∏–≤–æ–≤ (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)</h5>
            <p class="text-muted">–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã —Å –∞—Ä—Ö–∏–≤–∞–º–∏ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–∏—Ö –≤–µ—Ä—Å–∏—è—Ö.</p>
        </div>

        <div class="settings-panel" id="batch-settings">
            <h5><i class="bi bi-gear-fill"></i> –ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞</h5>
            <p>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–æ–≤ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤.</p>
            
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="batch-auto-detect" checked>
                <label class="form-check-label" for="batch-auto-detect">
                    –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ —Ç–∏–ø—É —Ñ–∞–π–ª–∞
                </label>
            </div>
        </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ -->
    <div class="row mt-4">
        <div class="col-12 text-center">
            <button type="button" class="btn btn-success btn-lg" id="start-conversion" disabled>
                <i class="bi bi-play-circle-fill"></i> –ù–∞—á–∞—Ç—å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é
            </button>
            
            <button type="button" class="btn btn-outline-secondary btn-lg ms-3" id="clear-all">
                <i class="bi bi-trash"></i> –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ
            </button>
        </div>
    </div>

    <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ -->
    <div class="conversion-progress" id="conversion-progress">
        <div class="row">
            <div class="col-12">
                <h5>–ü—Ä–æ–≥—Ä–µ—Å—Å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏</h5>
                
                <div class="progress-step" id="step-validate">
                    <div class="me-3">
                        <i class="bi bi-file-earmark-check" style="font-size: 1.5rem;"></i>
                    </div>
                    <div class="flex-grow-1">
                        <div><strong>–í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤</strong></div>
                        <small class="text-muted">–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤</small>
                    </div>
                    <div class="status-indicator status-pending"></div>
                </div>
                
                <div class="progress-step" id="step-convert">
                    <div class="me-3">
                        <i class="bi bi-arrow-repeat" style="font-size: 1.5rem;"></i>
                    </div>
                    <div class="flex-grow-1">
                        <div><strong>–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è</strong></div>
                        <small class="text-muted">–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤</small>
                    </div>
                    <div class="status-indicator status-pending"></div>
                </div>
                
                <div class="progress-step" id="step-save">
                    <div class="me-3">
                        <i class="bi bi-download" style="font-size: 1.5rem;"></i>
                    </div>
                    <div class="flex-grow-1">
                        <div><strong>–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ</strong></div>
                        <small class="text-muted">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</small>
                    </div>
                    <div class="status-indicator status-pending"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ -->
    <div class="conversion-stats" id="conversion-stats" style="display: none;">
        <h4>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏</h4>
        <div class="row">
            <div class="col-md-3">
                <div class="stat-item">
                    <span class="stat-number" id="total-files">0</span>
                    <span class="stat-label">–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤</span>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-item">
                    <span class="stat-number" id="completed-files">0</span>
                    <span class="stat-label">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</span>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-item">
                    <span class="stat-number" id="processing-time">0s</span>
                    <span class="stat-label">–í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏</span>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-item">
                    <span class="stat-number" id="total-size">0MB</span>
                    <span class="stat-label">–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä</span>
                </div>
            </div>
        </div>
    </div>

    <!-- –ì–∞–ª–µ—Ä–µ—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
    <div class="results-gallery" id="results-gallery"></div>

    <!-- –°—Ç–∞—Ç—É—Å –∞–¥–∞–ø—Ç–µ—Ä–æ–≤ -->
    <div class="adapter-status">
        <h5><i class="bi bi-cpu"></i> –°—Ç–∞—Ç—É—Å –¥–≤–∏–∂–∫–æ–≤ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏</h5>
        <div id="engine-status-list"></div>
        <button type="button" class="btn btn-outline-primary btn-sm mt-2" onclick="refreshEngineStatus()">
            <i class="bi bi-arrow-clockwise"></i> –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å
        </button>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
let selectedFiles = [];
let currentConverterType = 'video';
let conversionStartTime = null;
let completedFiles = 0;

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    initializeInterface();
    loadEngineStatus();
    setupEventListeners();
});

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
function initializeInterface() {
    // –í—ã–±–∏—Ä–∞–µ–º –ø–µ—Ä–≤—ã–π —Ç–∏–ø –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    selectConverterType('video');
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
    const qualityRange = document.getElementById('image-quality');
    const qualityValue = document.getElementById('quality-value');
    
    if (qualityRange && qualityValue) {
        qualityRange.addEventListener('input', function() {
            qualityValue.textContent = this.value + '%';
        });
    }
}

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
function setupEventListeners() {
    // –ö–ª–∏–∫ –ø–æ –∫–∞—Ä—Ç–æ—á–∫–∞–º –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç —Ç–∏–ø
    document.querySelectorAll('.converter-card').forEach(card => {
        card.addEventListener('click', function() {
            const type = this.getAttribute('data-type');
            selectConverterType(type);
        });
    });
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è –∞—É–¥–∏–æ
    const audioActionSelect = document.getElementById('audio-action');
    if (audioActionSelect) {
        audioActionSelect.addEventListener('change', function() {
            toggleAudioParams(this.value);
        });
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø–æ–ª–∑—É–Ω–∫–∞ –≥—Ä–æ–º–∫–æ—Å—Ç–∏ –∞—É–¥–∏–æ
    const audioVolumeRange = document.getElementById('audio-volume');
    const audioVolumeValue = document.getElementById('audio-volume-value');
    if (audioVolumeRange && audioVolumeValue) {
        audioVolumeRange.addEventListener('input', function() {
            audioVolumeValue.textContent = this.value + ' –¥–ë';
        });
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    const imageFormatSelect = document.getElementById('image-format');
    if (imageFormatSelect) {
        imageFormatSelect.addEventListener('change', function() {
            toggleGifParams(this.value);
        });
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —á–µ–∫–±–æ–∫—Å–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ GIF
    const createAnimatedGif = document.getElementById('create-animated-gif');
    if (createAnimatedGif) {
        createAnimatedGif.addEventListener('change', function() {
            toggleGifSettings(this.checked);
        });
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–æ–ª–∑—É–Ω–∫–æ–≤ GIF –Ω–∞—Å—Ç—Ä–æ–µ–∫
    const gifDurationRange = document.getElementById('gif-duration');
    const gifDurationValue = document.getElementById('gif-duration-value');
    if (gifDurationRange && gifDurationValue) {
        gifDurationRange.addEventListener('input', function() {
            gifDurationValue.textContent = this.value + '–º—Å';
        });
    }
    
    const gifFramesRange = document.getElementById('gif-frames');
    const gifFramesValue = document.getElementById('gif-frames-value');
    if (gifFramesRange && gifFramesValue) {
        gifFramesRange.addEventListener('input', function() {
            gifFramesValue.textContent = this.value;
        });
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ drag & drop
    const uploadZone = document.getElementById('upload-zone');
    const fileInput = document.getElementById('file-input');

    uploadZone.addEventListener('dragover', function(e) {
        e.preventDefault();
        this.classList.add('dragover');
    });

    uploadZone.addEventListener('dragleave', function(e) {
        e.preventDefault();
        this.classList.remove('dragover');
    });

    uploadZone.addEventListener('drop', function(e) {
        e.preventDefault();
        this.classList.remove('dragover');
        const files = e.dataTransfer.files;
        handleFileSelection(files);
    });

    fileInput.addEventListener('change', function() {
        handleFileSelection(this.files);
    });

    // –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    document.getElementById('start-conversion').addEventListener('click', startConversion);
    document.getElementById('clear-all').addEventListener('click', clearAllFiles);

}

// –í—ã–±–æ—Ä —Ç–∏–ø–∞ –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä–∞
function selectConverterType(type) {
    currentConverterType = type;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏
    document.querySelectorAll('.converter-card').forEach(card => {
        card.classList.remove('active');
    });
    
    document.querySelector(`[data-type="${type}"]`).classList.add('active');
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –ø–∞–Ω–µ–ª—å –Ω–∞—Å—Ç—Ä–æ–µ–∫
    document.querySelectorAll('.settings-panel').forEach(panel => {
        panel.classList.remove('active');
    });
    
    const settingsPanel = document.getElementById(`${type}-settings`);
    if (settingsPanel) {
        settingsPanel.classList.add('active');
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∑–æ–Ω—É –∑–∞–≥—Ä—É–∑–∫–∏
    updateUploadZone();
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–æ–Ω—ã –∑–∞–≥—Ä—É–∑–∫–∏
function updateUploadZone() {
    const uploadZone = document.getElementById('upload-zone');
    const uploadContent = uploadZone.querySelector('.upload-content');
    
    const typeInfo = {
        video: { icon: 'üé•', text: '–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –≤–∏–¥–µ–æ —Ñ–∞–π–ª—ã', accept: 'video/*' },
        image: { icon: 'üñºÔ∏è', text: '–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è', accept: 'image/*' },
        audio: { icon: 'üéµ', text: '–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∞—É–¥–∏–æ —Ñ–∞–π–ª—ã', accept: 'audio/*' },
        document: { icon: 'üìÑ', text: '–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã', accept: '.pdf,.doc,.docx' },
        archive: { icon: 'üóúÔ∏è', text: '–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∞—Ä—Ö–∏–≤—ã', accept: '.zip,.rar,.7z' },
        batch: { icon: 'üìÅ', text: '–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –ª—é–±—ã–µ —Ñ–∞–π–ª—ã', accept: '*/*' }
    };
    
    const info = typeInfo[currentConverterType] || typeInfo.batch;
    
    uploadContent.querySelector('div').textContent = info.icon;
    uploadContent.querySelector('h4').textContent = info.text + ' —Å—é–¥–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞';
    document.getElementById('file-input').setAttribute('accept', info.accept);
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
function handleFileSelection(files) {
    const fileArray = Array.from(files);
    
    // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∞–π–ª—ã –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É —Å–ø–∏—Å–∫—É
    selectedFiles.push(...fileArray.map(file => ({
        file: file,
        status: 'pending',
        type: detectFileType(file.name),
        size: file.size,
        result: null
    })));
    
    updateFileList();
    updateUploadZoneStatus();
    updateStartButton();
}

// –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
function detectFileType(filename) {
    const ext = filename.toLowerCase().split('.').pop();
    
    const typeMap = {
        // –í–∏–¥–µ–æ
        'mp4': 'video', 'avi': 'video', 'mov': 'video', 'mkv': 'video', 'webm': 'video',
        'flv': 'video', 'm4v': 'video', 'wmv': 'video', 'mpg': 'video', 'mpeg': 'video',
        
        // –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        'jpg': 'image', 'jpeg': 'image', 'png': 'image', 'gif': 'image', 'bmp': 'image',
        'webp': 'image', 'tiff': 'image', 'svg': 'image', 'ico': 'image',
        
        // –ê—É–¥–∏–æ
        'mp3': 'audio', 'wav': 'audio', 'flac': 'audio', 'ogg': 'audio', 'aac': 'audio',
        'm4a': 'audio', 'wma': 'audio', 'opus': 'audio',
        
        // –î–æ–∫—É–º–µ–Ω—Ç—ã
        'pdf': 'document', 'doc': 'document', 'docx': 'document', 'rtf': 'document',
        'odt': 'document', 'txt': 'document', 'md': 'document',
        
        // –ê—Ä—Ö–∏–≤—ã
        'zip': 'archive', 'rar': 'archive', '7z': 'archive', 'tar': 'archive',
        'gz': 'archive', 'bz2': 'archive'
    };
    
    return typeMap[ext] || 'unknown';
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤
function updateFileList() {
    const fileList = document.getElementById('file-list');
    
    if (selectedFiles.length === 0) {
        fileList.innerHTML = '';
        return;
    }
    
    const html = selectedFiles.map((fileInfo, index) => {
        const iconMap = {
            video: 'üé•', image: 'üñºÔ∏è', audio: 'üéµ', 
            document: 'üìÑ', archive: 'üóúÔ∏è', unknown: '‚ùì'
        };
        
        return `
            <div class="file-item">
                <div class="file-info">
                    <div class="file-icon">${iconMap[fileInfo.type]}</div>
                    <div>
                        <div class="fw-bold">${fileInfo.file.name}</div>
                        <small class="text-muted">
                            ${(fileInfo.size / 1024 / 1024).toFixed(1)} MB ‚Ä¢ ${fileInfo.type}
                        </small>
                    </div>
                </div>
                <div class="file-actions">
                    <button type="button" class="btn btn-sm btn-outline-danger" 
                            onclick="removeFile(${index})">
                        <i class="bi bi-trash"></i>
                    </button>
                </div>
                <div class="status-indicator status-${fileInfo.status}"></div>
            </div>
        `;
    }).join('');
    
    fileList.innerHTML = html;
}

// –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –∏–∑ —Å–ø–∏—Å–∫–∞
function removeFile(index) {
    selectedFiles.splice(index, 1);
    updateFileList();
    updateUploadZoneStatus();
    updateStartButton();
}

// –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤
function clearAllFiles() {
    selectedFiles = [];
    updateFileList();
    updateUploadZoneStatus();
    updateStartButton();
    hideConversionProgress();
    document.getElementById('results-gallery').innerHTML = '';
    document.getElementById('conversion-stats').style.display = 'none';
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–æ–Ω—ã –∑–∞–≥—Ä—É–∑–∫–∏
function updateUploadZoneStatus() {
    const uploadZone = document.getElementById('upload-zone');
    
    if (selectedFiles.length > 0) {
        uploadZone.classList.add('has-files');
    } else {
        uploadZone.classList.remove('has-files');
    }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –∑–∞–ø—É—Å–∫–∞
function updateStartButton() {
    const startButton = document.getElementById('start-conversion');
    startButton.disabled = selectedFiles.length === 0;
}

// –ó–∞–ø—É—Å–∫ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
async function startConversion() {
    if (selectedFiles.length === 0) return;
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
    showConversionProgress();
    conversionStartTime = Date.now();
    completedFiles = 0;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    updateStats();
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤
    updateProgressStep('validate', 'active');
    await delay(500);
    
    // –§–∏–ª—å—Ç—Ä—É–µ–º –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–∞–π–ª—ã
    const supportedFiles = selectedFiles.filter(fileInfo => {
        // –î–ª—è –¥–µ–º–æ - –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –≤–∏–¥–µ–æ –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        return fileInfo.type === 'video' || fileInfo.type === 'image';
    });
    
    if (supportedFiles.length === 0) {
        alert('–ù–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤ –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏');
        hideConversionProgress();
        return;
    }
    
    updateProgressStep('validate', 'completed');
    updateProgressStep('convert', 'active');
    
    // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –∫–∞–∂–¥—ã–π —Ñ–∞–π–ª
    for (let i = 0; i < supportedFiles.length; i++) {
        const fileInfo = supportedFiles[i];
        fileInfo.status = 'processing';
        updateFileList();
        
        try {
            const result = await convertFile(fileInfo);
            
            if (result.success) {
                fileInfo.status = 'completed';
                fileInfo.result = result;
                completedFiles++;
            } else {
                fileInfo.status = 'error';
                console.error('–û—à–∏–±–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏:', result.error);
            }
        } catch (error) {
            fileInfo.status = 'error';
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ —Ñ–∞–π–ª–∞:', error);
        }
        
        updateFileList();
        updateStats();
    }
    
    updateProgressStep('convert', 'completed');
    updateProgressStep('save', 'active');
    await delay(500);
    updateProgressStep('save', 'completed');
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    displayResults();
}

// –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
async function convertFile(fileInfo) {
    const formData = new FormData();
    
    if (fileInfo.type === 'video') {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π API –¥–ª—è –≤–∏–¥–µ–æ
        formData.append('video', fileInfo.file);
        formData.append('width', document.getElementById('video-width').value);
        formData.append('fps', document.getElementById('video-fps').value);
        formData.append('start_time', document.getElementById('video-start-time').value);
        formData.append('end_time', document.getElementById('video-end-time').value);
        formData.append('grayscale', document.getElementById('video-grayscale').checked ? '1' : '0');
        formData.append('reverse', document.getElementById('video-reverse').checked ? '1' : '0');
        formData.append('boomerang', document.getElementById('video-boomerang').checked ? '1' : '0');
        
        const response = await fetch('/converter/ajax_convert/', {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': getCsrfToken()
            }
        });
        
        return await response.json();
        
    } else if (fileInfo.type === 'image') {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—ã–π API –∞–¥–∞–ø—Ç–µ—Ä–æ–≤ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
        formData.append('file', fileInfo.file);
        formData.append('output_format', document.getElementById('image-format').value || 'jpg');
        
        const width = document.getElementById('image-width').value;
        const height = document.getElementById('image-height').value;
        if (width) formData.append('width', width);
        if (height) formData.append('height', height);
        formData.append('quality', document.getElementById('image-quality').value);
        
        // –î–æ–±–∞–≤–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ GIF
        const createAnimatedGif = document.getElementById('create-animated-gif');
        if (createAnimatedGif && createAnimatedGif.checked) {
            formData.append('create_animated_gif', '1');
            formData.append('gif_effect', document.getElementById('gif-effect').value);
            formData.append('gif_duration', document.getElementById('gif-duration').value);
            formData.append('gif_frames', document.getElementById('gif-frames').value);
            formData.append('gif_loop', document.getElementById('gif-loop').checked ? '1' : '0');
        }
        
        const response = await fetch('/converter/convert_with_adapters/', {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': getCsrfToken()
            }
        });
        
        return await response.json();
    }
    
    // –î–ª—è –Ω–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö —Ç–∏–ø–æ–≤
    return { success: false, error: '–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ç–∏–ø —Ñ–∞–π–ª–∞' };
}

// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
function displayResults() {
    const gallery = document.getElementById('results-gallery');
    const completedFiles = selectedFiles.filter(f => f.status === 'completed');
    
    const html = completedFiles.map(fileInfo => {
        const result = fileInfo.result;
        let previewContent = '';
        
        if (fileInfo.type === 'video') {
            previewContent = `<img src="${result.gif_url}" alt="Converted GIF" class="result-preview">`;
        } else if (fileInfo.type === 'image') {
            previewContent = `<img src="${result.output_url || result.output_path}" alt="Converted Image" class="result-preview">`;
        } else {
            previewContent = `<div class="result-preview">üìÑ</div>`;
        }
        
        return `
            <div class="result-card">
                ${previewContent}
                <h6>${fileInfo.file.name}</h6>
                <p class="small text-muted">${fileInfo.type} ‚Üí ${getOutputFormat(fileInfo)}</p>
                <div class="btn-group btn-group-sm w-100">
                    <button type="button" class="btn btn-outline-primary" onclick="downloadResult('${result.gif_url || result.output_url}')">
                        <i class="bi bi-download"></i> –°–∫–∞—á–∞—Ç—å
                    </button>
                    <button type="button" class="btn btn-outline-secondary" onclick="shareResult('${result.gif_url || result.output_url}')">
                        <i class="bi bi-share"></i> –ü–æ–¥–µ–ª–∏—Ç—å—Å—è
                    </button>
                </div>
            </div>
        `;
    }).join('');
    
    gallery.innerHTML = html;
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—ã—Ö–æ–¥–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞
function getOutputFormat(fileInfo) {
    if (fileInfo.type === 'video') {
        return 'GIF';
    } else if (fileInfo.type === 'image') {
        return (document.getElementById('image-format').value || 'jpg').toUpperCase();
    }
    return 'Unknown';
}

// –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
function downloadResult(url) {
    const link = document.createElement('a');
    link.href = url;
    link.download = url.split('/').pop();
    link.click();
}

// –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º
function shareResult(url) {
    if (navigator.share) {
        navigator.share({
            title: '–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–∞–π–ª',
            url: url
        });
    } else {
        navigator.clipboard.writeText(window.location.origin + url);
        alert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
    }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
function updateStats() {
    document.getElementById('total-files').textContent = selectedFiles.length;
    document.getElementById('completed-files').textContent = completedFiles;
    
    if (conversionStartTime) {
        const elapsed = Math.round((Date.now() - conversionStartTime) / 1000);
        document.getElementById('processing-time').textContent = elapsed + 's';
    }
    
    const totalSize = selectedFiles.reduce((sum, f) => sum + f.file.size, 0);
    document.getElementById('total-size').textContent = (totalSize / 1024 / 1024).toFixed(1) + 'MB';
    
    document.getElementById('conversion-stats').style.display = 'block';
}

// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º
function showConversionProgress() {
    document.getElementById('conversion-progress').style.display = 'block';
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ —à–∞–≥–∏
    document.querySelectorAll('.progress-step').forEach(step => {
        step.classList.remove('active', 'completed');
        const indicator = step.querySelector('.status-indicator');
        indicator.className = 'status-indicator status-pending';
    });
}

function hideConversionProgress() {
    document.getElementById('conversion-progress').style.display = 'none';
}

function updateProgressStep(stepId, status) {
    const step = document.getElementById(`step-${stepId}`);
    const indicator = step.querySelector('.status-indicator');
    
    step.classList.remove('active', 'completed');
    if (status === 'active') {
        step.classList.add('active');
        indicator.className = 'status-indicator status-processing';
    } else if (status === 'completed') {
        step.classList.add('completed');
        indicator.className = 'status-indicator status-completed';
    }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –¥–≤–∏–∂–∫–æ–≤
async function loadEngineStatus() {
    try {
        const response = await fetch('/converter/engine_status/');
        const status = await response.json();
        displayEngineStatus(status);
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –¥–≤–∏–∂–∫–æ–≤:', error);
    }
}

// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –¥–≤–∏–∂–∫–æ–≤
function displayEngineStatus(status) {
    const container = document.getElementById('engine-status-list');
    
    const html = Object.entries(status).map(([engineType, info]) => {
        const badgeClass = info.available ? 'bg-success' : 'bg-danger';
        const badgeText = info.available ? '–î–æ—Å—Ç—É–ø–µ–Ω' : '–ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω';
        
        return `
            <div class="engine-status">
                <div>
                    <strong>${engineType.charAt(0).toUpperCase() + engineType.slice(1)} Engine</strong>
                    <div class="small text-muted">
                        –í—Ö–æ–¥–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤: ${info.supported_formats?.input?.length || 0}, 
                        –≤—ã—Ö–æ–¥–Ω—ã—Ö: ${info.supported_formats?.output?.length || 0}
                    </div>
                </div>
                <span class="badge ${badgeClass}">${badgeText}</span>
            </div>
        `;
    }).join('');
    
    container.innerHTML = html;
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –¥–≤–∏–∂–∫–æ–≤
async function refreshEngineStatus() {
    await loadEngineStatus();
}

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∞—É–¥–∏–æ
function toggleAudioParams(action) {
    const convertParams = document.getElementById('audio-convert-params');
    const speechParams = document.getElementById('speech-to-text-params');
    const outputFormatGroup = document.getElementById('audio-output-format-group');
    
    if (action === 'speech-to-text') {
        // –°–∫—Ä—ã–≤–∞–µ–º –æ–±—ã—á–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
        convertParams.style.display = 'none';
        outputFormatGroup.style.display = 'none';
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã Speech-to-Text
        speechParams.style.display = 'block';
    } else {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±—ã—á–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
        convertParams.style.display = 'block';
        outputFormatGroup.style.display = 'block';
        
        // –°–∫—Ä—ã–≤–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã Speech-to-Text
        speechParams.style.display = 'none';
    }
}

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ GIF
function toggleGifParams(format) {
    const gifAnimationParams = document.getElementById('gif-animation-params');
    
    if (format === 'gif') {
        gifAnimationParams.style.display = 'block';
    } else {
        gifAnimationParams.style.display = 'none';
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —á–µ–∫–±–æ–∫—Å —Å–æ–∑–¥–∞–Ω–∏—è –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ GIF
        const createAnimatedGif = document.getElementById('create-animated-gif');
        if (createAnimatedGif) {
            createAnimatedGif.checked = false;
            toggleGifSettings(false);
        }
    }
}

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ GIF –∞–Ω–∏–º–∞—Ü–∏–∏
function toggleGifSettings(enabled) {
    const gifSettings = document.getElementById('gif-settings');
    
    if (enabled) {
        gifSettings.style.display = 'block';
    } else {
        gifSettings.style.display = 'none';
    }
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
function getCsrfToken() {
    const cookies = document.cookie.split(';');
    for (let cookie of cookies) {
        const [name, value] = cookie.trim().split('=');
        if (name === 'csrftoken') {
            return value;
        }
    }
    return '';
}

function delay(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}
</script>
{% endblock %}
