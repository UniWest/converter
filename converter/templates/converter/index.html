{% extends 'converter/base.html' %}

{% block title %}–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –≤–∏–¥–µ–æ –≤ GIF - –ì–ª–∞–≤–Ω–∞—è{% endblock %}

{% block content %}

<!-- –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –∏ —É—Å–ø–µ—Ö–µ -->
{% if messages %}
    {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert" aria-live="polite">
            {% if message.tags == 'error' %}
                <i class="bi bi-exclamation-triangle-fill me-2" aria-hidden="true"></i>
            {% elif message.tags == 'success' %}
                <i class="bi bi-check-circle-fill me-2" aria-hidden="true"></i>
            {% else %}
                <i class="bi bi-info-circle-fill me-2" aria-hidden="true"></i>
            {% endif %}
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="–ó–∞–∫—Ä—ã—Ç—å"></button>
        </div>
    {% endfor %}
{% endif %}

<div class="row">
    <div class="col-md-8 mx-auto">
        <form method="post" enctype="multipart/form-data" id="upload-form" class="fade-in" role="form" aria-label="–§–æ—Ä–º–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤–∏–¥–µ–æ –≤ GIF">
            {% csrf_token %}
            
            <!-- –í—ã–±–æ—Ä —Ñ–∞–π–ª–∞ -->
            <div class="mb-4">
                <div class="file-input-wrapper" onclick="document.getElementById('{{ form.video.id_for_label }}').click()" role="button" tabindex="0" aria-label="–û–±–ª–∞—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞" onkeydown="if(event.key==='Enter'||event.key===' '){this.click()}">
                    <div class="upload-icon" aria-hidden="true">üìπ</div>
                    <h5>–ó–∞–≥—Ä—É–∑–∏—Ç–µ –≤–∏–¥–µ–æ —Ñ–∞–π–ª</h5>
                    <p class="text-muted">–ù–∞–∂–º–∏—Ç–µ –∑–¥–µ—Å—å –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª</p>
                    <p class="file-name text-primary fw-bold" id="selected-file-name" aria-live="polite">–§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω</p>
                    <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
                    <div class="upload-progress mt-2" id="upload-progress" style="display: none;">
                        <div class="progress">
                            <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" id="upload-progress-bar">
                                <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞: 0%</span>
                            </div>
                        </div>
                        <small class="text-muted mt-1 d-block" id="upload-status">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∑–∞–≥—Ä—É–∑–∫–µ...</small>
                    </div>
                </div>
                
                {{ form.video }}
                
                {% if form.video.errors %}
                    <div class="text-danger mt-2" role="alert" aria-live="polite">
                        {% for error in form.video.errors %}
                            <small>{{ error }}</small>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
            
            <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ -->
            <div class="conversion-settings slide-in-left">
                <h5><i class="bi bi-gear-fill" aria-hidden="true"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏</h5>
                
                <!-- –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã -->
                <div class="mb-3">
                    <div class="form-check settings-group">
                        {{ form.keep_original_size }}
                        <label for="{{ form.keep_original_size.id_for_label }}" class="form-check-label">
                            {{ form.keep_original_size.label }}
                        </label>
                        {% if form.keep_original_size.help_text %}
                            <div class="form-text">{{ form.keep_original_size.help_text }}</div>
                        {% endif %}
                        {% if form.keep_original_size.errors %}
                            <div class="text-danger" role="alert" aria-live="polite">
                                {% for error in form.keep_original_size.errors %}
                                    <small>{{ error }}</small>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                </div>

                <div class="row">
                    <!-- –®–∏—Ä–∏–Ω–∞ -->
                    <div class="col-md-6" id="width-setting">
                        <div class="settings-group">
                            <label for="{{ form.width.id_for_label }}" class="form-label">
                                <i class="bi bi-aspect-ratio me-2" aria-hidden="true"></i>
                                {{ form.width.label }}
                            </label>
                            {{ form.width }}
                            {% if form.width.help_text %}
                                <div class="form-text">{{ form.width.help_text }}</div>
                            {% endif %}
                            {% if form.width.errors %}
                                <div class="text-danger" role="alert" aria-live="polite">
                                    {% for error in form.width.errors %}
                                        <small>{{ error }}</small>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- FPS -->
                    <div class="col-md-6">
                        <div class="settings-group">
                            <label for="{{ form.fps.id_for_label }}" class="form-label">
                                <i class="bi bi-speedometer2 me-2" aria-hidden="true"></i>
                                {{ form.fps.label }}
                            </label>
                            {{ form.fps }}
                            {% if form.fps.help_text %}
                                <div class="form-text">{{ form.fps.help_text }}</div>
                            {% endif %}
                            {% if form.fps.errors %}
                                <div class="text-danger" role="alert" aria-live="polite">
                                    {% for error in form.fps.errors %}
                                        <small>{{ error }}</small>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã -->
                <div class="row mt-3">
                    <!-- –°–∫–æ—Ä–æ—Å—Ç—å -->
                    <div class="col-md-6">
                        <div class="settings-group">
                            <label for="{{ form.speed.id_for_label }}" class="form-label">
                                <i class="bi bi-lightning me-2" aria-hidden="true"></i>
                                {{ form.speed.label }}
                            </label>
                            {{ form.speed }}
                        </div>
                    </div>

                    <!-- –ö–∞—á–µ—Å—Ç–≤–æ —Ü–≤–µ—Ç–∞ -->
                    <div class="col-md-6">
                        <div class="settings-group">
                            <div class="form-check">
                                {{ form.high_quality }}
                                <label for="{{ form.high_quality.id_for_label }}" class="form-check-label">
                                    {{ form.high_quality.label }}
                                </label>
                            </div>
                            <div class="mt-2" id="dither-select-wrapper">
                                <label for="{{ form.dither.id_for_label }}" class="form-label">
                                    {{ form.dither.label }}
                                </label>
                                {{ form.dither }}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –≠—Ñ—Ñ–µ–∫—Ç—ã -->
                <div class="row mt-3">
                    <div class="col-12">
                        <div class="settings-group">
                            <label class="form-label">–≠—Ñ—Ñ–µ–∫—Ç—ã:</label>
                            <div class="d-flex flex-wrap gap-3 mt-2">
                                <div class="form-check form-check-inline">
                                    {{ form.grayscale }}
                                    <label for="{{ form.grayscale.id_for_label }}" class="form-check-label">
                                        {{ form.grayscale.label }}
                                    </label>
                                </div>
                                <div class="form-check form-check-inline">
                                    {{ form.reverse }}
                                    <label for="{{ form.reverse.id_for_label }}" class="form-check-label">
                                        {{ form.reverse.label }}
                                    </label>
                                </div>
                                <div class="form-check form-check-inline">
                                    {{ form.boomerang }}
                                    <label for="{{ form.boomerang.id_for_label }}" class="form-check-label">
                                        {{ form.boomerang.label }}
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row mt-3">
                    <!-- –ù–∞—á–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è -->
                    <div class="col-md-6">
                        <div class="settings-group">
                            <label for="{{ form.start_time.id_for_label }}" class="form-label">
                                <i class="bi bi-skip-start me-2" aria-hidden="true"></i>
                                {{ form.start_time.label }}
                            </label>
                            {{ form.start_time }}
                            {% if form.start_time.help_text %}
                                <div class="form-text">{{ form.start_time.help_text }}</div>
                            {% endif %}
                            {% if form.start_time.errors %}
                                <div class="text-danger" role="alert" aria-live="polite">
                                    {% for error in form.start_time.errors %}
                                        <small>{{ error }}</small>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- –ö–æ–Ω–µ—á–Ω–æ–µ –≤—Ä–µ–º—è -->
                    <div class="col-md-6">
                        <div class="settings-group">
                            <label for="{{ form.end_time.id_for_label }}" class="form-label">
                                <i class="bi bi-skip-end me-2" aria-hidden="true"></i>
                                {{ form.end_time.label }}
                            </label>
                            {{ form.end_time }}
                            {% if form.end_time.help_text %}
                                <div class="form-text">{{ form.end_time.help_text }}</div>
                            {% endif %}
                            {% if form.end_time.errors %}
                                <div class="text-danger" role="alert" aria-live="polite">
                                    {% for error in form.end_time.errors %}
                                        <small>{{ error }}</small>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <!-- –û–±—â–∏–µ –æ—à–∏–±–∫–∏ —Ñ–æ—Ä–º—ã -->
                {% if form.non_field_errors %}
                    <div class="alert alert-danger" role="alert" aria-live="polite">
                        {% for error in form.non_field_errors %}
                            <p class="mb-0">{{ error }}</p>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
            
            <!-- –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ -->
            <div class="text-center slide-in-right">
                <button type="submit" class="btn btn-primary btn-lg" id="convert-btn">
                    <i class="bi bi-play-circle-fill me-2"></i>
                    –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ GIF
                </button>
            </div>
        </form>
        
        <!-- –°–ø–∏–Ω–Ω–µ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
        <div class="loading-spinner" id="loading-spinner">
            <div class="spinner-border" role="status">
                <span class="visually-hidden">–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è...</span>
            </div>
            <h5 class="mt-3">–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤–∏–¥–µ–æ...</h5>
            <p class="text-muted">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ. –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ –≤–∏–¥–µ–æ.</p>
            
            <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω) -->
            <div class="progress mt-3" style="display: none;">
                <div class="progress-bar" role="progressbar" style="width: 0%"></div>
            </div>
        </div>
    </div>
</div>

<!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
<div class="row mt-5">
    <div class="col-md-4">
        <div class="feature-card fade-in">
            <div class="feature-icon">‚ö°</div>
            <h5>–ë—ã—Å—Ç—Ä–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞</h5>
            <p class="text-muted mb-0">–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ FFmpeg –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</p>
        </div>
    </div>
    <div class="col-md-4">
        <div class="feature-card fade-in">
            <div class="feature-icon">üîß</div>
            <h5>–ì–∏–±–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h5>
            <p class="text-muted mb-0">–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ä–∞–∑–º–µ—Ä, —á–∞—Å—Ç–æ—Ç—É –∫–∞–¥—Ä–æ–≤ –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–∞–º–∫–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞</p>
        </div>
    </div>
    <div class="col-md-4">
        <div class="feature-card fade-in">
            <div class="feature-icon">üì±</div>
            <h5>–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–æ—Ä–º–∞—Ç–æ–≤</h5>
            <p class="text-muted mb-0">MP4, AVI, MOV, MKV, WMV, WebM –∏ –¥—Ä—É–≥–∏–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –≤–∏–¥–µ–æ —Ñ–æ—Ä–º–∞—Ç—ã</p>
        </div>
    </div>
</div>

<!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é -->
<div class="row mt-4">
    <div class="col-12">
        <div class="conversion-settings fade-in">
            <h5 class="mb-3">
                <i class="bi bi-info-circle me-2"></i>
                –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä
            </h5>
            <div class="row">
                <div class="col-md-3 text-center mb-3">
                    <div class="feature-icon">1Ô∏è‚É£</div>
                    <h6>–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª</h6>
                    <small class="text-muted">–ó–∞–≥—Ä—É–∑–∏—Ç–µ –≤–∏–¥–µ–æ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –µ–≥–æ –≤ –æ–±–ª–∞—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏</small>
                </div>
                <div class="col-md-3 text-center mb-3">
                    <div class="feature-icon">2Ô∏è‚É£</div>
                    <h6>–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</h6>
                    <small class="text-muted">–£–∫–∞–∂–∏—Ç–µ —Ä–∞–∑–º–µ—Ä, FPS –∏ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∏–Ω—Ç–µ—Ä–≤–∞–ª</small>
                </div>
                <div class="col-md-3 text-center mb-3">
                    <div class="feature-icon">3Ô∏è‚É£</div>
                    <h6>–ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é</h6>
                    <small class="text-muted">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –∏ –¥–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è</small>
                </div>
                <div class="col-md-3 text-center mb-3">
                    <div class="feature-icon">4Ô∏è‚É£</div>
                    <h6>–°–∫–∞—á–∞–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç</h6>
                    <small class="text-muted">–ü–æ–ª—É—á–∏—Ç–µ –≥–æ—Ç–æ–≤—ã–π GIF —Ñ–∞–π–ª</small>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('upload-form');
    const fileInput = document.getElementById('{{ form.video.id_for_label }}');
    const convertBtn = document.getElementById('convert-btn');
    const spinner = document.getElementById('loading-spinner');
    const keepOriginalSizeCheckbox = document.getElementById('{{ form.keep_original_size.id_for_label }}');
    const widthSetting = document.getElementById('width-setting');
    const widthInput = document.getElementById('{{ form.width.id_for_label }}');
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ–∫–±–æ–∫—Å–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤
    function toggleWidthSetting() {
        if (keepOriginalSizeCheckbox && keepOriginalSizeCheckbox.checked) {
            widthSetting.style.opacity = '0.5';
            widthSetting.style.pointerEvents = 'none';
            if (widthInput) widthInput.disabled = true;
        } else {
            widthSetting.style.opacity = '1';
            widthSetting.style.pointerEvents = 'auto';
            if (widthInput) widthInput.disabled = false;
        }
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
    if (keepOriginalSizeCheckbox) {
        toggleWidthSetting();
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–µ–∫–±–æ–∫—Å–∞
        keepOriginalSizeCheckbox.addEventListener('change', toggleWidthSetting);
    }
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
    fileInput.addEventListener('change', function() {
        updateFileName(this);
        if (validateFile(this)) {
            // –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ñ–∞–π–ª–µ
            getVideoInfo(this.files[0]);
        }
    });
    
    // Drag & Drop functionality
    const fileWrapper = document.querySelector('.file-input-wrapper');
    
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        fileWrapper.addEventListener(eventName, preventDefaults, false);
        document.body.addEventListener(eventName, preventDefaults, false);
    });
    
    ['dragenter', 'dragover'].forEach(eventName => {
        fileWrapper.addEventListener(eventName, highlight, false);
    });
    
    ['dragleave', 'drop'].forEach(eventName => {
        fileWrapper.addEventListener(eventName, unhighlight, false);
    });
    
    fileWrapper.addEventListener('drop', handleDrop, false);
    
    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }
    
    function highlight(e) {
        fileWrapper.classList.add('border-primary');
        fileWrapper.style.borderColor = 'var(--light-purple)';
        fileWrapper.style.backgroundColor = 'var(--bg-purple-lighter)';
    }
    
    function unhighlight(e) {
        fileWrapper.classList.remove('border-primary');
        fileWrapper.style.borderColor = '';
        fileWrapper.style.backgroundColor = '';
    }
    
    function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;
        
        if (files.length > 0) {
            fileInput.files = files;
            updateFileName(fileInput);
            if (validateFile(fileInput)) {
                getVideoInfo(files[0]);
            }
        }
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–∞
    function validateFile(input) {
        if (!input.files || !input.files[0]) {
            return false;
        }
        
        const file = input.files[0];
        const allowedTypes = ['video/mp4', 'video/avi', 'video/mov', 'video/quicktime', 'video/x-msvideo', 'video/webm'];
        const maxSize = 500 * 1024 * 1024; // 500 MB
        
        if (!allowedTypes.includes(file.type) && !file.name.match(/\.(mp4|avi|mov|mkv|wmv|webm|m4v)$/i)) {
            showAlert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∏–¥–µ–æ—Ñ–∞–π–ª.', 'error');
            return false;
        }
        
        if (file.size > maxSize) {
            showAlert('–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º—É–º 500 –ú–ë.', 'error');
            return false;
        }
        
        return true;
    }
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞
    function updateFileName(input) {
        const fileNameElement = document.querySelector('.file-name');
        if (input.files && input.files[0]) {
            const fileName = input.files[0].name;
            const fileSize = (input.files[0].size / (1024 * 1024)).toFixed(2);
            fileNameElement.textContent = `${fileName} (${fileSize} –ú–ë)`;
            fileNameElement.style.color = 'var(--primary-purple)';
            fileNameElement.innerHTML = `<i class="bi bi-check-circle me-1"></i>${fileName} (${fileSize} –ú–ë)`;
        } else {
            fileNameElement.textContent = '–§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω';
            fileNameElement.style.color = '#6c757d';
            fileNameElement.innerHTML = '–§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω';
        }
    }
    
    // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã
    form.addEventListener('submit', function(e) {
        const file = fileInput.files[0];
        if (!file) {
            e.preventDefault();
            showAlert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∏–¥–µ–æ —Ñ–∞–π–ª', 'warning');
            return false;
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏–Ω–Ω–µ—Ä —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
        convertBtn.disabled = true;
        convertBtn.innerHTML = '<div class="spinner-border spinner-border-sm me-2"></div>–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è...';
        
        spinner.style.display = 'block';
        spinner.classList.add('fade-in');
        
        // –ü–ª–∞–≤–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ —Å–ø–∏–Ω–Ω–µ—Ä—É
        spinner.scrollIntoView({ 
            behavior: 'smooth',
            block: 'center'
        });
        
        // –°–∏–º—É–ª—è—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
        simulateProgress();
    });
    
    // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤–∏–¥–µ–æ
    function getVideoInfo(file) {
        if (!file) return;
        
        const formData = new FormData();
        formData.append('video', file);
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
        const loadingIndicator = document.createElement('div');
        loadingIndicator.className = 'alert alert-info mt-2';
        loadingIndicator.innerHTML = '<i class="bi bi-hourglass-split me-2"></i>–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤–∏–¥–µ–æ...';
        
        // –£–¥–∞–ª–∏—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        const existingAlerts = document.querySelectorAll('.alert-info');
        existingAlerts.forEach(alert => alert.remove());
        
        fileWrapper.parentNode.appendChild(loadingIndicator);
        
        fetch('{% url "converter:video_info" %}', {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
            }
        })
        .then(response => response.json())
        .then(data => {
            loadingIndicator.remove();
            
            if (data.success && data.info) {
                const info = data.info;
                let infoText = `–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${Math.round(info.duration)}—Å`;
                if (info.width && info.height) {
                    infoText += `, –†–∞–∑–º–µ—Ä: ${info.width}x${info.height}`;
                }
                if (info.fps) {
                    infoText += `, FPS: ${Math.round(info.fps)}`;
                }
                
                // –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–∏–¥–µ–æ
                const infoDiv = document.createElement('div');
                infoDiv.className = 'alert alert-info mt-2 slide-in-left';
                infoDiv.innerHTML = `<i class="bi bi-info-circle me-2"></i>${infoText}`;
                
                fileWrapper.parentNode.appendChild(infoDiv);
                
                // –ê–≤—Ç–æ–Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
                autoConfigureSettings(info);
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥
                setTimeout(() => {
                    infoDiv.style.transition = 'opacity 0.5s ease';
                    infoDiv.style.opacity = '0';
                    setTimeout(() => infoDiv.remove(), 500);
                }, 10000);
            }
        })
        .catch(error => {
            loadingIndicator.remove();
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤–∏–¥–µ–æ:', error);
            showAlert('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–∏–¥–µ–æ', 'warning');
        });
    }
    
    // –ê–≤—Ç–æ–Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤–∏–¥–µ–æ
    function autoConfigureSettings(info) {
        // –ê–≤—Ç–æ–Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —à–∏—Ä–∏–Ω—ã –¥–ª—è –±–æ–ª—å—à–∏—Ö –≤–∏–¥–µ–æ
        if (info.width > 1920) {
            const widthInput = document.getElementById('{{ form.width.id_for_label }}');
            if (widthInput && !widthInput.value) {
                widthInput.value = 1920;
                showAlert('–®–∏—Ä–∏–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –Ω–∞ 1920px –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ GIF', 'info');
            }
        }
        
        // –ê–≤—Ç–æ–Ω–∞—Å—Ç—Ä–æ–π–∫–∞ FPS –¥–ª—è –≤—ã—Å–æ–∫–æ—á–∞—Å—Ç–æ—Ç–Ω—ã—Ö –≤–∏–¥–µ–æ
        if (info.fps > 30) {
            const fpsInput = document.getElementById('{{ form.fps.id_for_label }}');
            if (fpsInput && !fpsInput.value) {
                fpsInput.value = 15;
                showAlert('FPS –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ 15 –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ GIF', 'info');
            }
        }
    }
    
    // –°–∏–º—É–ª—è—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
    function simulateProgress() {
        const progressBar = document.querySelector('.progress');
        const progressBarFill = document.querySelector('.progress-bar');
        
        if (progressBar && progressBarFill) {
            progressBar.style.display = 'block';
            let progress = 0;
            
            const interval = setInterval(() => {
                progress += Math.random() * 3;
                if (progress > 95) progress = 95;
                
                progressBarFill.style.width = progress + '%';
                progressBarFill.textContent = Math.round(progress) + '%';
            }, 1000);
            
            // –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–∏–º—É–ª—è—Ü–∏—é —á–µ—Ä–µ–∑ 30 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                clearInterval(interval);
            }, 30000);
        }
    }
    
    // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    function showAlert(message, type = 'info') {
        const alertDiv = document.createElement('div');
        alertDiv.className = `alert alert-${type} alert-dismissible fade show slide-in-left`;
        alertDiv.innerHTML = `
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        
        const contentArea = document.querySelector('.content-area');
        contentArea.insertBefore(alertDiv, contentArea.firstChild);
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
        setTimeout(() => {
            if (document.body.contains(alertDiv)) {
                const bsAlert = new bootstrap.Alert(alertDiv);
                bsAlert.close();
            }
        }, 5000);
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–Ω–∏–º–∞—Ü–∏–π –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    setTimeout(() => {
        document.querySelectorAll('.fade-in, .slide-in-left, .slide-in-right').forEach((el, index) => {
            el.style.animationDelay = (index * 0.1) + 's';
        });
    }, 100);
});
</script>
{% endblock %}
